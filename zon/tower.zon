/*
filename    tower
password    kermit
changedby   Papi
EmailAdd    
request     compile
version     9
END HEADER*/

#include <composed.h>

%zone tower
title "The Kithyrn Tower"
lifespan 20
reset RESET_ANYHOW
creators {"kira"}

/*       *********     The Kithyrn Tower Zone     *********       */

#define EIYONEL_ONGOING "Eiyonel's Quest Ongoing"
#define EIYONEL_COMPLETE "Eiyonel's Quest Complete"
#define ARISTOL_ONGOING "Aristol's Quest Ongoing"
#define ARISTOL_COMPLETE "Aristol's Quest Complete"
#define DRYNMYR_ONGOING "Drynmyr's Quest Ongoing"
#define DRYNMYR_COMPLETE "Drynmyr's Quest Complete"
#define KITHYRN_COMPLETE "Kithyrn Tower Traversed"

notes "&l        This is my first zone, designed with players of lvl 5 to
     14 in mind.  By looking and searching there is a great deal of
     information for players to gain.  Additionally, there are
     three quests of increasing complexity which together help set
     up a fourth.  Players are rewarded with an object of their
     choice for completion of the fourth quest.
        Since much of the programming for this zone was done between
     the hours of 2 and 6 o'clock AM, any comments or suggestions
     would be much appreciated, and should be sent to Ryan Holliday
     (Kira) at wrh2@po.cwru.edu."

help "&l        The Kithyrn tower zone is a zone designed with players of
     levels five to fourteen in mind.  As you go higher in the tower
     the mobs become progressively more difficult.  Be sure to search
     everywhere as there is much to be found by searching.
        Since this is my first zone I would very much like to hear
     your feedback.  You can either mudmail me (Kira), or, if you
     prefer, just use the 'BUG' or 'TYPO' commands while you're in the
     zone. (For example, type 'bug I think there should be flaming
     artichoke jugglers somewhere in the zone').  If you have any
     complaints, please repeat them over and over again to either
     Kyt or Zex, both of whom will be more than glad to listen to
     hours upon hours of endless bitching. :)
     "

%dil

/*  Dil to block all spells, thus creating a 'no magic' room.  Code
    modified from that in Asgaard, written by Andrew Cowan (Icculus) */

dilbegin no_magic();
code {
  :start:
    wait (SFB_CMD, TRUE);
    if ((activator.type == UNIT_ST_PC) and command(CMD_CAST)) {
      block;
      act("The spell fails.  Magic is apparently ineffective here.",
           A_ALWAYS, self.inside, null, null, TO_ALL);
    }
    goto start;
}
dilend

%rooms

/*        *********     Outside of the Tower     *********        */

                        darkwood_east
title "The Dark Woods"
descr
"&l   The trees in this forest look almost dead except for the few black
leaves which still adorn their branches.  They appear to be older than
anything which you have encountered before, and you wonder what these
giants might be able to tell you if only they could speak of their pasts.
The path through the trees continues north, east and west."

extra {"trees", "tree", "giants", "giant"}
"&lThe trees which surround you are huge, and they look as if they might
date back many hundreds of years."

extra {"black leaves", "leaves"}
"&lThe leaves look withered and dead, yet you sense that these trees are
still not quite ready to relinquish their hold on life."

extra {"pathway", "path"}
"This dirt trail leads north, east, and west through the forest."

flags {UNIT_FL_NO_MOB}
movement SECT_FOREST
west to ratswarf/darkwood descr "Darkwood forest is there.";
north to small_hill descr "A small hill is there.";
east to cloud_path descr "A faint trail leads east.";
end    /* end darkwood_east */

                        cloud_path
title "The Dark Woods"
descr
"&l   Mist sits in the hollows of the forest as you travel along this frail
path.  The massive trees which surround you block out much of the light
and make it difficult to see anything that is more than fifty feet away.
The trail continues to the east and west."

extra {"massive trees", "trees", "tree", "giants", "giant"}
"&lThe trees which surround you are huge, and they look as if they might
date back many hundreds of years."

extra {"black leaves", "leaves"}
"&lThe leaves look withered and dead, yet you sense that these trees are
still not quite ready to relinquish their hold on life."

extra {"mist", "hollows"}
"&lA small amount of mist remains like a blanket in the hollows of the
forest."

extra {"pathway", "path"}
"This dirt trail leads east and west through the forest."

flags {UNIT_FL_NO_MOB}
movement SECT_FOREST
west to darkwood_east descr "The path continues in this direction.";
east to cloud_ent descr "A faint trail leads east.";
end    /* end cloud_path */

                        cloud_ent
title "The Dark Woods"
descr
"&l   The massive and ancient trees of Darkwood forest feel almost like they
are reaching out at you as you pass amongst them.  The trail which winds
through this wood seems like your only safe haven in this foreboding land.
To the east it looks like there is a clearing, while to the west the
forest continues."

extra {"massive trees", "trees", "tree", "giants", "giant"}
"&lThe trees which surround you are huge, and they look as if they might
date back many hundreds of years."

extra {"black leaves", "leaves"}
"&lThe leaves look withered and dead, yet you sense that these trees are
still not quite ready to relinquish their hold on life."

extra {"pathway", "path"}
"Hi, I'm Kira.  I only wrote this room because Tyk made me."

flags {UNIT_FL_NO_MOB}
movement SECT_FOREST
west to cloud_path descr "The path continues in this direction.";
east to cloud/clearing descr "There is a clearing there..";
end    /* end cloud_ent */

                        small_hill
title "A Small Hill"
descr
"&l   The trees thin out as the land gently rises, and to the north you
can see what appears to be a battered tower rising from the trees.  The
path continues north and south."

extra {"battered tower", "tower"}
"&lThis tower is so well hidden in the forest that you could not have
noticed it if you had not come to higher ground.  It looks as though it
may have been a prosperous place at one time, but now seems to have fallen
into disrepair."

extra {"pathway", "path"}
"This dirt trail leads north and south through the forest."

extra {"trees", "tree", "giants", "giant"}
"&lThe trees which surround you are huge, and they look as if they might
date back many hundreds of years."


movement SECT_FOREST
north to before_tower descr "The path leads to the base of the tower.";
south to darkwood_east descr "The dark woods are there.";
end    /* end small_hill */

                        before_tower
names {"kithyrn"}
title "Before Kithyrn Tower"
descr
"&l   The tower is much larger than you originally thought, with thick
stone walls that reach high up into the air.  The tower looks to be of
elven craftsmanship, although the vines which cover the walls and the
cracks in the stones indicate that any elves who once lived here have
probably gone.  A huge entryway, which is decorated with ancient writing,
leads into the tower, while a path leads to the east."

extra {"vines", "cracks", "stone", "stones"}
"&lThe vines which climb the tower reach high up to a great height, while
the cracks in the tower stone are broad and weathered.  You guess that
no one has worked to maintain this structure in many years."

extra {"fanciful runes", "runes", "ancient writing", "writing"}
"&lThe writing is apparently of elven origin, although the effects of the
weather have worn it down a great deal."

extra {"path", "pathway"}
"This dirt path leads east around the tower."

extra {"tower"}
"The tower rises vertically from the ground up to a great height."

flags {UNIT_FL_NO_MOB}
movement SECT_FOREST
north to floor_1m open {EX_OPEN_CLOSE} descr
     "The entryway is nearly twice your height, and looks quite weathered."
     keyword {"huge entryway", "entryway", "door"};
south to small_hill descr "The small hill is there.";
east to tower_southeast descr
     "This path leads to outside the southeast corner of the tower.";
end    /* before_tower */

                        tower_southeast
title "Outside the Southeastern Corner of the Tower"
descr
"&l   You are standing at the southeast corner of the tower.  Brush
and other debris are everywhere, partially obscuring the trail which you
have been following.  The path continues north around the tower, and west
to the tower entrance."

extra {"path", "pathway"}
"This dirt pathway leads north and west around the tower."

extra {"brush", "debris", "weeds", "stones", "sticks"}
"&lWeeds have grown up in the path, making it slightly difficult to
traverse.  Additionally, sticks and stones have collected, and you must
watch your step to make sure that you do not trip."

extra {"tower"}
"The tower rises vertically from the ground up to a great height."


movement SECT_FOREST
north to tower_east descr "The path leads north around the tower.";
west to before_tower descr "This path leads back to the front of the tower.";
end    /* tower_southeast */

                        tower_east
title "The Eastern Side of the Tower"
descr
"&l   You are on a path leading north and south.  Various weeds and
grasses are growing along the path, some of them reaching as high as
your waist.  It is obvious that no one has been worked to maintain
this trail in a very long time.  The tower, rising high into the air,
is to your west, while the sounds of running water come from the east."

extra {"path"}
"This dirt path leads north and south around the tower."

extra {"brush", "debris", "weeds", "stones", "sticks"}
"&lWeeds have grown up in the path, making it slightly difficult to
traverse.  Additionally, sticks and stones have collected, and you must
watch your step to make sure that you do not trip."

extra {"tower"}
"The tower rises vertically from the ground up to a great height."


movement SECT_FOREST
north to tower_northeast descr "The path leads north around the tower.";
south to tower_southeast descr "The path leads south around the tower.";
east to by_stream descr "It sounds like there may be a stream there.";
end    /* tower_east */

                        tower_northeast
title "Outside the Northeastern Corner of the Tower"
descr
"&l   You are standing outside of the northeastern side of the tower.
Like the portions of this path which you have already traversed, weeds
and tall grasses have sprung up everywhere.  The path continues to the
west and south."

extra {"path", "pathway"}
"This dirt pathway leads north and west around the tower."

extra {"brush", "debris", "weeds", "stones", "sticks"}
"&lWeeds have grown up in the path, making it slightly difficult to
traverse.  Additionally, sticks and stones have collected, and you must
watch your step to make sure that you do not trip."

extra {"tower"}
"The tower rises vertically from the ground up to a great height."


movement SECT_FOREST
west to tower_north descr "The path leads to the back of the tower.";
south to tower_east descr "The path leads to the eastern side of the tower.";
end    /* tower_northeast */

                        tower_north
title "The Back of the Tower"
descr
"&l   You have reached the back of the tower.  A pile of large granite
stones is here, presumably detritus from the poorly maintained tower.  A
small set of stairs leads down to a door that is set against the tower.
The only other visible exit is back to the east."

extra {"stairs"}
"&lThere are four stone stairs which lead down to an ancient oak door.
It looks like this may perhaps be an entrance to the tower basement."

extra {"path", "pathway"}
"This dirt pathway leads north and west around the tower."

extra {"stone", "stones", "granite", "detritus"}
"&lThese stones are massive, with the largest being as big as you.  They
appear to have fallen from the higher reaches of the tower's walls."

extra {"tower"}
"The tower rises vertically from the ground up to a great height."


movement SECT_FOREST

down to under_entry open {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}
     key basement_key
     descr "A weather-worn oak door is here." keyword {"oak door", "door"};
east to tower_northeast descr
     "The path leads back to the northeast corner of the tower.";
end    /* tower_north */

                        by_stream
names {"stream"}
title "By a Bubbling Stream"
descr
"&l   The small path which you have followed leads down to this small,
rocky stream.  The residents of the tower which you left behind would
obviously need some water, and apparently this stream was the provider.
The cool water gushes and bubbles around many rocks and boulders, laughing
happily as it travels along.  Trees, bushes, and other plants in the area
provide shade, making this a most pleasant spot."

extra {"water", "rocks", "boulders", "rock", "boulder", "stream"}
"&lThe water is crystal clear, and it gushes down around the many rocks
and boulders in an almost playful manner."

extra {"trees", "tree", "plants", "shade", "juniper bushes", "bushes"}
"&lA number of trees and plants grow here, obviously taking advantage of
the plentiful supply of water.  The trees have grown tall and strong, and
they provide a cool shade for you to rest in.  You notice several juniper
bushes, although someone has apparently stripped them of their berries."


movement SECT_FOREST
west to tower_east descr "The path leads to the east side of the tower.";
end    /* by_stream */

/*           *********     The First Floor     *********           */

                        floor_1a
title "The End of the Great Hall"
descr
"&l   You have come to the end of the hallway.  This corner of the tower
is very sparse, and the only feature which makes it any different from the
rest of the tower is a small window that is set high up on the wall.  You
notice that the light which is shining in from this window seems to glint
off of some scratches in the wall in a peculiar manner."

extra {"window"}
"&lThe window is set about fifteen feet up from the floor and is allowing
light to shine in from outside."

extra {"oily dirt", "wall", "dirt"}
"&lThe wall is covered with the same oily dirt that you have seen throughout
the tower.  There are some scratches on the eastern wall, and as you look
more closely you realize that they may be a message of some sort."

extra {"scratches", "light"}
"&lLooking at these scratches more carefully you realize that they are
actually the words of a message.  It reads:

     On the advice of Eiyonel and the other high elves we have
     chosen to leave the tower Kithyrn.  The day of Ancalador is
     over, and our time in this realm seems to be coming to a
     similar termination.  We leave the tower and some of our
     finer creations to whomever might choose to claim them, for
     either may again be of use to those who choose to dwell in
     this land..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_1c descr "The Great Hall continues in this direction.";
ALWAYS_LIGHT
end    /* floor_1a */

                        floor_1b
names {"guard room"}
title "The Abandoned Guard Room"
descr
"&l   You have entered one of the tower's guard posts.  From the dust and
disarray you guess that this post has not been manned for a very long time.
There are two beds on the far wall and a table in the center of the room,
while the rusted remains of what may at one time have been guard weapons
lie piled in a corner.  You also recognize a foul smell which permeates
the room -- the elves may have abandoned this tower, but the stench of
goblin shows that other creatures have apparently decided to move in."

extra {"table", "two beds", "beds", "bed"}
"&lThe beds and table look like they have not been used for a very,
very long time."

extra {"pile", "remains", "weapons"}
"&lIt looks as if these may have been useful weapons at one time, but those
which were valuable have obviously already been taken, and the remainder
have now become so rusted as to be completely useless."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_1c open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door here." keyword {"door"};
ALWAYS_LIGHT
end    /* floor_1b */

                        floor_1c
title "The Great Hall"
descr
"&l   From this point you may take any direction in the tower.  The Great
Hall continues to the north and south, while a smaller hallway leads to the
east.  There is a door to the west."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_1b open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door here." keyword {"door"};
north to floor_1a descr "The Great Hall continues in this direction.";
south to floor_1g descr "The Great Hall continues in this direction.";
east to floor_1d descr "There is a hallway in this direction.";
ALWAYS_LIGHT
end    /* floor_1c */

                        floor_1d
title "The Hallway"
descr
"&l   The small hallway comes to a rather abrupt end at this point.
There do not appear to be any exits other than back the way from which
you came, although you find it strange that such an ornate hallway would
lead to no where.  Listening closely, you can barely make out a soft
humming noise which sounds as if it is coming from one of the walls.  A
window on the eastern wall provides a dim light to this area."

extra {"window", "eastern wall"}
"&lLike the other windows of this tower, this one is set about twelve feet
up from the floor, allowing a small amount of light in."

extra {"wall", "walls", "oily dirt", "dirt"}
"&lDue to the scarcity of light it is tough to closely examine the walls,
although they appear to be covered in the same oily dirt that coats the
other walls of the tower.  The humming noise that you noticed earlier most
definitely seems to be coming from behind one of these walls..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_1h open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
     keyword {"door", "exit", "wall", "walls"}
     descr "You discover a hidden doorway.";
SECRET_DOOR_DIFFICULTY (SOUTH, 3)
west to floor_1c descr "The Great Hall is in this direction.";
ALWAYS_LIGHT
end    /* floor_1d */

                        floor_1e
title "The First Floor Stairway"
descr
"&l   You have reached the first floor stairway.  The stairs spiral up,
out of your view, and you can not tell what might be above."

extra {"spiral stairs", "stairs", "stairway"}
"&lApparently the stairs go up.  If you think that they should go somewhere
else, feel free to mudmail Kira with your suggestion."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_1f descr "This direction leads back to the hallway.";
up to floor_between descr "The stairs go up.";
ALWAYS_LIGHT
end    /* floor_1e */

                        floor_1f
title "The Hallway"
descr
"&l   The hallway leads west to a spiral stairway, and east to the Central
Hall.  To the south is a closed door made of heavy oak, with rather ornate
elven runes carved around it in stone."

extra {"elven runes", "runes"}
"&lYou recognize the runes as those used in ancient times by elves in order
to ward off evil influences.  However, ancient elven writings are not
something which you know a great deal about, and you are unable to read
exactly what has been written."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_1j open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
east to floor_1g descr "The Central Hall is there.";
west to floor_1e descr "The stairway is there.";
ALWAYS_LIGHT
end    /* floor_1f */

                        floor_1g
names {"central hall"}
title "The Central Hall"
descr
"&l   The Great Hall expands slightly at this point, creating a huge
central area.  There is a great deal of debris strewn about the area,
while the walls are covered in the same oily dirt that you have seen
before.  An elven statue, depicting a kindly-looking old elf, lies near
the eastern wall.  The Great Hall continues north and south, and a
smaller hallway leads west."

extra {"walls", "oily dirt", "dirt", "soot"}
"&lThe walls are covered in an oily dirt that looks like it has been
accumulating for some time now.  The tower has obviously not been
maintained for quite a while."

extra {"statue", "old elf", "elf", "inscription", "eastern wall"}
"&lThis statue depicts a smiling elf who looks very, very old. He stands
with both hands outstretched in a posture of greeting.  Beneath the
statue is an inscription which reads:

     'Accept the healing of the tower elves, all who rest here.
      For those who seek counsel, search me out within the walls
      of Kithyrn, and I shall aid you.'
                       --Eiyonel"

extra {"debris", "trash", "stone"}
"&lTrash of various sorts, as well as stone which has chipped off from the
walls and ceilings, is strewn about the floor."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_SACRED}
movement SECT_INSIDE
south to floor_1k descr "The Great Hall continues in this direction.";
north to floor_1c descr "The Great Hall continues in this direction.";
west to floor_1f descr "A smaller hallway is in this direction.";
ALWAYS_LIGHT
end    /* floor_1g */

                        floor_1h
title "The Entrance to Eiyonel's Room"
descr
"&l   This area, in contrast with the rest of the tower, is extremely
beautiful.  The walls are free of the dirt and soot that was present
everywhere else in the tower, and the white stone shines with an
incredible brilliance.  The air in this room smells of incense, and the
humming sound which you noticed before is now more pronounced."

extra {"walls", "white stone", "stone"}
"&lThe stone, when cleaned of dirt, is extremely beautiful and reflects the
light in a way that is so glorious that you are nearly overwhelmed.  You
wonder why this room is so different from the rest of the tower..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_MOB}
movement SECT_INSIDE
north to floor_1d open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
east to floor_1i descr "Eiyonel's Quarters continue in this direction";
south to floor_1l descr "Eiyonel's Quarters continue in this direction";
ALWAYS_LIGHT
end    /* floor_1h */

                        floor_1i
title "Eiyonel's Quarters"
descr
"&l   Like the room which you just left, this room is immaculately clean.
A small bed is in the corner here, and there are shelves along the walls
that are full of ancient books.  Light shines down through a window above
the bed.  Various herbs and other supplies are stored in a corner."

extra {"small bed", "bed", "mattress", "tag"}
"The bed is neatly made.  There is a tag lying next to the mattress which
reads 'Do not remove this tag under penalty of the law.'"

extra {"shelves", "ancient books", "books"}
"&lThe shelves contain hundreds of books, all of them written in the
ancient elven language, and all of them looking extremely old."

extra {"various herbs", "various supplies", "herbs", "supplies"}
"&lThe herbs and supplies are neatly stored in the corner.  You guess that
there are probably over five hundred different types of herbs here, although
you know the function of only a few."

extra {"window"}
"&lThe window is set about six feet above the floor, and it allows light
to shine into the room."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_TELEPORT}
movement SECT_INSIDE
west to floor_1h descr "The entrance to Eiyonel's Quarters is there.";
ALWAYS_LIGHT
end    /* floor_1i */

                        floor_1j
names {"history room", "history", "room of tower history"}
title "The Room of Tower History"
descr
"&l     This room, unlike the others which you have been in, shows no
sign of having been disturbed.  It remains clean, and you can only wonder
why it has been left alone.  There are charts set on the walls, each with
a great deal of writing on it.  You wonder if you should perhaps read
some of them."

extra {"chart", "charts", "writing", "wall", "walls"}
"&lThere are two charts here to be read.  One seems to contain history
of the tower, and is labeled 'Tower Chart', while the other seems to be
a brief history of Valhalla, and is labeled 'World Chart.'"

extra {"tower chart"}
"&l     The tower Kithyrn was built in the earliest years of Valhalla
     by the descendents of the first elves.  The tower elves devoted
     themselves to the pursuit of knowledge and accumulated great
     quantities of information, storing much of it within Kithyrn.
     During the time of Ancalador the elves played an integral role
     in defeating this foe, but afterwards realized that the time of
     the elves in the world had ended as humans came to prominence.
     With the exception of a select few elves who remained behind to
     protect the tower treasures, the tower elves have now vanished
     completely, their location remaining a mystery."

extra {"world chart"}
"&l     Little is known about the origins of Valhalla.  The earliest
     historical accounts tell of elves, dwarves, and other creatures
     who lived together harmoniously.  As time progressed humans began
     arriving in the land, along with orcs, goblins, and the ever-feared
     dragons.  The most powerful of these dragons was Ancalador, who
     gathered together the evil creatures of the land and waged a long
     and bloody war against the forces of good.  Only after many long
     years did goodness prevail, and even so many evil remnants of
     Ancalador's reign still remain in the land.  The actual body of
     Ancalador was frozen in stone by powerful magic and lies to this
     day in the mountains south of King's Road."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_1f open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
ALWAYS_LIGHT
end    /* floor_1j */

                        floor_1k
title "The Great Hall"
descr
"&l   The Great Hall continues in this direction.  The soot and dirt
which you noticed covering the walls and floor in other areas is here
as well.  To the north the hall seems to become somewhat larger, and to
the south is the tower entrance."

extra {"walls", "oily dirt", "dirt", "soot"}
"&lThe walls are covered in an oily dirt that looks like it has been
accumulating for some time now.  The tower has obviously not been
maintained for quite a while."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_1g descr "The Central Hall is in this direction.";
south to floor_1m descr "The tower entrance is in this direction.";
ALWAYS_LIGHT
end    /* floor_1k */

                        floor_1l
title "Eiyonel's Study Area"
descr
"&l   This area is apparently used by Eiyonel as a study area.  A table is
set up against the wall, and it is covered by books.  Various charts and
maps cover the eastern wall, and vials containing potions of some sort
cover a shelf on the western wall.  The only exit from this area is to
the north."

extra {"table", "books", "candle", "stick", "incense"}
"&lThe table is a simple one, and is covered by a great number of ancient
books, many of which are opened.  There is a small stick of incense burning
on one corner of the table, as well as a candle."

extra {"charts", "maps", "timelines", "histories"}
"&lThe charts and maps look extremely old.  The labels on the maps indicate
that they are of the world as it was almost five hundred years ago.  The
charts seem to be timelines and histories, although they are written in the
elven language, so you are unable to read them."

extra {"vials", "shelf", "potions"}
"&lThe shelf holds almost three hundred different potions, although you have
no idea what they might do."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_TELEPORT}
movement SECT_INSIDE
north to floor_1h descr "The entrance to Eiyonel's Quarters is there.";
ALWAYS_LIGHT
end    /* floor_1l */

                        floor_1m
names {"tower entrance"}
title "The Entrance Into the Tower"
descr
"&l   You have entered the tower and are now standing in a gigantic room
with vaulted ceilings that must be thirty feet high.  The walls are made
of a stone that was probably quite beautiful at one time, but it is now
almost completely covered with soot and dirt.  There are two broken
statues on either side of the entryway that look almost as if they are
guarding the entrance.  You can continue north in the tower, or leave the
tower to the south."

extra {"walls", "oily dirt", "dirt", "soot"}
"&lThe walls are covered in an oily dirt that looks like it has been
accumulating for some time now.  The tower has obviously not been
maintained in quite a while."

extra {"statue", "statues", "swords", "sword", "king", "soldier", "elf"}
"&lThese statues have been damaged by the effects of both time and vandals.
Dirt, soot, and chips in the stone have distorted the features of the stone
figures, although you are still able to recognize two elven figures, each
clad in elven armor and wielding swords.  The statue to your left appears
to of an elven king, while the one on the right might perhaps be one of
the elven fighters which are spoken of in legends."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to before_tower open {EX_OPEN_CLOSE} descr
     "The entryway to the tower is there." keyword {"door", "entryway"};
north to floor_1k descr "You see a very large room ahead of you.";
ALWAYS_LIGHT
end    /* floor_1m */

/*          *********     The Second Floor     *********          */

                        floor_between
title "The Spiral Stairway"
descr
"&l   The stairs continue to spiral upwards.  It looks as if they might
come to an end somewhere above."

extra {"spiral stairs", "stairs", "stairway"}
"&lThese stairs go both up and down.  Again, any suggestions of alternate
routes may be mudmailed to Kira."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
up to floor_2e descr "The top of the spiral stair is there.";
down to floor_1e descr "The base of the spiral stair is there.";
ALWAYS_LIGHT
end    /* floor_between */

                        floor_2a
title "The Northern Gallery"
descr
"&l   The gallery expands here into one which is circular in shape.  The
focus of this room seems to be a statue which is located in the center of
the gallery.  There is a circular window high up on the northern wall
which allows enough light into the room to illuminate it well.  The only
visible exit is to the south."

extra {"statue", "levethyn", "traveler", "plaque"}
"&lThe statue is of an elf who is well-equipped for travelling.  He holds
a strange stick in his right hand, which looks like it might perhaps be
magical in some way.  A plaque under the statue reads:

            'Levethyn, traveler of Valhalla'"

extra {"strange stick", "magical stick", "stick"}
"&lThe stick which Levethyn holds looks like it might in some way help him
in his travels.  You wonder if it might perhaps be one of the legendary
sticks of bridging which Odin's eagle servant is known to possess."

extra {"circular window", "window", "northern wall", "wall"}
"&lThe window is circular and is set about ten feet above the floor."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_2c descr "The elven gallery is there.";
ALWAYS_LIGHT
end    /* floor_2a */

                        floor_2b
title "The Tower Stairs"
descr
"&l   The stairway leading up to the higher levels of the tower is here.
The stairway is rather steep, and it spirals up and out of view.  The only
other exit from this room is to the east."

extra {"spiral stairway", "spiral stairs", "stair", "stairway", "stairs"}
"The stairs spiral up towards the higher levels of the tower."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_2c open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
up to floor_3b descr "The stairs continue up, out of view.";
ALWAYS_LIGHT
end    /* floor_2b */

                        floor_2c
title "The Elven Gallery"
descr
"&l   Like the other rooms on this floor, this room seems to be a gallery
of some sort, although much of what was once here has obviously been
removed.  The eastern wall is covered by a carving of many different
scenes, most of them involving elves facing tribulations of one kind or
another.  Exits are to the north and south, while there is a door to the
west."

extra {"eastern wall", "stone carving", "carving", "wall", "elves", "scenes"}
"&lThis stone carving has been ravaged by time and vandals, yet still
remains quite detailed and lovely.  It is divided into five sections,
each one picturing elves being faced by one hardship or another.  The
central section is especially prominent, and pictures an elf struggling
against a storm as he tries to reach a distant tower.  Under his arm he
carries a large bundle which is wrapped in cloth.  Around him are the
eyes of various menacing creatures, including a dragon which circles
above him among the storm clouds."

extra {"central section", "elf", "dragon", "eyes", "bundle", "cloth"}
"&lThe struggle of this elf that has been captured in stone is inspiring.
Obviously he is carrying an object of tremendous importance which many
foul creatures want to deprive him of."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_2b open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
north to floor_2a descr "The elven gallery is there.";
south to floor_2g descr "The fountain is there.";
ALWAYS_LIGHT
end    /* floor_2c */

                        floor_2d
title "Aristol's Private Study"
descr
"&l   From the many books and scrolls in this room you guess that you have
found Aristol's study chamber.  It seems that this is the place where
Aristol learns of the skills of past weaponmasters, as well as the
weapons which these masters wielded.  You notice that Aristol himself has
begun the construction of several new types of weapons which now rest upon
his desk."

extra {"books", "scrolls", "book", "scroll"}
"&lThese books and sheets of parchment look very old, but also look to have
been treated with almost loving care.  Aristol obviously takes his studies
of the arts of weaponry very seriously, following it with great passion."

extra {"desk", "weapons", "new types"}
"&lLying on the desk are the beginnings of what you guess to be two
crossbows, as well as an ornately carved staff and several small daggers."

extra {"crossbows", "crossbow", "staff", "dagger", "daggers"}
"&lThese weapons have not yet been completed, but they look to be of
exquisite craftsmanship, and you get the feeling that they will do great
honor to whomever shall one day wield them."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_TELEPORT}
movement SECT_INSIDE
south to floor_2h descr "Aristol's quarters are there.";
ALWAYS_LIGHT
end    /* floor_2d */

                        floor_2e
title "The Top of the Spiral Stair"
descr
"&l   You have reached the top of the spiral stair.  This part of the
tower is not as grand as the lower section, although the craftsmanship here
shows a much greater attention to detail.  An arched stone passageway leads
off to the east."

extra {"arched stone passageway", "passageway", "stone", "hall", "arch"}
"&lThis passageway is built of small round stones which have been carefully
pieced together to form a beautiful hall."

extra {"stairs", "spiral stairway", "stairway", "stair"}
"The stairs spiral down towards the bottom of the tower."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_2f descr "The arched stone passageway leads in this direction.";
down to floor_between descr "The stairs go down.";
ALWAYS_LIGHT
end    /* floor_2e */

                        floor_2f
title "The Elven Gallery"
descr
"&l   This floor appears to be some sort of elven gallery.  The runes and
other details of the walls are exquisite, showing brilliant craftsmanship.
Much of the gallery's beauty is obscured by the dirt and debris which has
been allowed to accumulate over the years, but this detritus has not been
able to altogether erase the charm of the hall.  The hall continues east
to a central gallery, or west to the spiral stair."

extra {"runes", "details", "carvings", "walls", "wall", "artwork"}
"&lThe elven runes and other small carvings in the stone of the walls shows
amazing attention to detail.  Despite the dirt and debris which has
accumulated on them, this elven artwork is still very beautiful. "

extra {"dirt", "debris", "detritus", "grime"}
"&lThe amount of grime and dirt which has collected throughout the tower
indicate that no one has made any effort to maintain the tower for a very
long time."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_2e descr "The top of the spiral stair is there.";
east to floor_2g descr "There is a fountain there.";
ALWAYS_LIGHT
end    /* floor_2f */

                        floor_2g
names {"elven gallery", "elven fountain"}
title "The Elven Fountain"
descr
"&l   The central feature of this room is a small fountain.  Cool water
flows out from a central statue, and then cascades down three tiers of
beautiful white stone.  There is a sense of peacefulness in this place,
and you wonder if perhaps it would be a good area to rest yourself."

extra {"white stone", "cool water", "stone", "tiers", "water"}
"&lThe water flowing out of the center of this fountain cascades lightly
over three levels of pure white stone, collecting in a large pool at the
base of the fountain.  The water looks refreshing, and you feel that a
drink might not be so bad."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_SACRED}
movement SECT_INSIDE
west to floor_2f descr "The elven gallery is there.";
north to floor_2c descr "The elven gallery is there.";
south to floor_2k descr "The elven gallery is there.";
ALWAYS_LIGHT
end    /* floor_2g */

                        floor_2h
title "Aristol's Quarters"
descr
"&l   All of the necessities of a spartan life are stored in this room.
Earthenware containers, baskets, and wooden boxes line the western wall,
each holding the bare essentials for Aristol's work.  Other various
items are stored on shelves, while vegetables, meats, herbs, and other
foodstuffs hang from the ceiling to dry.  There is a study to the north,
and Aristol's sleeping quarters are to the east."

extra {"earthenware", "containers", "baskets", "wooden boxes", "boxes"}
"&lThe containers lined up along the western wall hold linens, various
fibers, minerals, and all of the other materials which Aristol uses in his
work."

extra {"items", "shelves"}
"Books, papers, tools, and a multitude of other items are on the shelves."

extra {"vegetables", "meats", "herbs", "foodstuffs", "ceiling"}
"&lAristol has stored most of his food by hanging it on small cords from
the ceiling.  The foods which he keeps do not look especially tasty,
although you suppose that they have very high nutritional value."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_2d descr "Aristol's study is there.";
east to floor_2i descr "Aristol's sleeping quarters are there.";
south to floor_2l descr "The entry to Aristol's quarters is there.";
ALWAYS_LIGHT
end    /* floor_2h */

                        floor_2i
title "Aristol's Sleeping Quarters"
descr
"&l   The room is bare except for a bed which is along the eastern wall,
a window which is set above the bed, and a rack which contains several
beautifully crafted weapons.  The simplicity of the room lends it a
military air, which is obviously the way that Aristol prefers it to be.
The only exit is back to the west."

extra {"bed", "snapshot"}
"The bed is quite ordinary.  It is neatly made and very clean.  Next to the
bed is a snapshot of Trinity and Denathor together smoking, while Dax looks
on jealously."

extra {"circular window", "window", "eastern wall", "wall"}
"&lThe window is about four feet above the floor, and it allows light to
shine into the room."

extra {"rack", "weapons"}
"&lThis rack is the only decoration in the room.  The weapons on it were
most likely crafted by Aristol himself, and are some of the best that
you have ever seen.  Each is of the finest quality, and each is
beautifully decorated.  Whoever should wield one of these armaments
would be lucky indeed."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_2h descr "Aristol's store room is there.";
ALWAYS_LIGHT
end    /* floor_2i */

                        floor_2j
title "The Elven Gallery"
descr
"&l   Like the other rooms of this floor, this room was obviously once
a part of a magnificent gallery, but has now been laid to waste by the
effects of time and vandals.  The ornate runes and other carvings on the
walls are covered in grime, and whatever might once have been displayed
here is now gone.  All that remains of the room's former glory is a large
pile of rubble which has been gathered into the northwest corner of the
room."

/*  ******************NOTE:  ADD ITEM ???  **********************  */
extra {"rubble", "pile"}
"&lBits of stone, glass, and metal have all been collected here into a large
pile.  You might find something interesting buried in here, if Kira would
ever take the time to program it... :)" /*  You notice a ??? which is
partially buried amidst the rubble...this may be something worth taking
a closer look at." */

extra {"runes", "details", "carvings", "walls", "wall", "artwork"}
"&lThe elven runes and other small carvings in the stone of the walls shows
amazing attention to detail.  Despite the dirt and debris which has
accumulated on them, closer inspection reveals that this elven artwork
is still quite beautiful. "

extra {"dirt", "debris", "grime"}
"&lThe amount of grime and dirt which has collected throughout the tower
indicate that no one has made any effort to maintain the tower for a very
long time."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_2k descr "The elven gallery is there.";
ALWAYS_LIGHT
end    /* floor_2j */

                        floor_2k
title "The Elven Gallery"
descr
"&l   A tattered tapestry on the eastern wall is all that distinguishes
this room from the others which you have explored.  Exits lead to
the north, west, and south."

extra {"tattered tapestry", "tapestry", "fabric", "elves", "tower", "holes"}
"&lThe tapestry is old but you can faintly make out images of what appear
to be elves and of the tower.  There are holes in the fabric in many places,
and looking through them you think you can make out the outlines of a door
behind the artwork..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_2l open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
     keyword {"door", "exit", "wall", "walls", "tapestry", "artwork"}
     descr "You discover a door hidden behind the tapestry.";
SECRET_DOOR_DIFFICULTY (EAST, 3)
west to floor_2j descr "The elven gallery is there.";
south to floor_2m descr "The southern gallery is there.";
north to floor_2g descr "The elven gallery is there.";
ALWAYS_LIGHT
end    /* floor_2k */

                        floor_2l
title "The Entrance to Aristol's Quarters"
descr
"&l   The change in your surroundings is stunning.  The dinginess which
you have experienced in the rest of the tower disappears into almost extreme
cleanliness.  The walls shine, the floor is recently swept, and nothing has
been allowed to fall into disrepair.  It is almost as if military discipline
is being enforced in this area.  These quarters continue to the north, or
you can exit to the west."

extra {"floor"}
"&lThe floor is completely free of debris, which is definitely a contrast
from the rest of the tower."

extra {"walls", "white stone", "stone"}
"&lThe stone, when cleaned of dirt, is extremely beautiful and reflects the
light in a way that is so glorious that you are nearly overwhelmed.  You
wonder why this room is so different from the rest of the tower..."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_2k open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
north to floor_2h descr "Aristol's quarters are there.";
ALWAYS_LIGHT
end    /* floor_2l */

                        floor_2m
names {"southern gallery"}
title "The Southern Gallery"
descr
"&l   The hallway expands here into a circular shape with a pedestal in
the center.  A window on the south wall allows light to shine in, and
the way in which it reflects off of the pedestal is indicative of a
sundial.  Markings on the floor form a circular pattern in what might
perhaps be a method of marking off the season.  The remainder of the room
is in the same state of disrepair as the rest of the tower, with dirt and
debris scattered all over.  The only exit is to the north."

extra {"dirt", "debris", "grime"}
"&lThe dirt and debris make this a really disgusting area.  Standing here
looking at the mess, the thought comes to you, 'Kyt drinks eggnog by the
carton... Kyt sits on the stairs of Zeta Beta Tau wishing he was dead...
eggnog in quantity is a bad thing!'"

extra {"window", "south wall", "wall", "light"}
"&lThe window on the south wall allows a circular beam of light to shine
into the room and onto the sundial at the room's center."

extra {"pedestal", "sundial", "metal", "glass", "rainbow", "markings"}
"&lThere is a thin metal triangle sticking out of the top of the pedestal,
casting a shadow onto the top of the sundial.  Additionally, a glass sphere
which is set into the metal further causes the light to seperate into a
rainbow which then cascades down onto the markings on the floor.  The effect
is rather dramatic and very beautiful."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_2k descr "The elven gallery is there.";
ALWAYS_LIGHT
end    /* floor_2m */

/*          *********     The Third Floor     *********          */

                        floor_3a
title "The Bottom of the Third Floor Stairway"
descr
"&l   Unlike the other stairs of the tower, these stairs do not spiral,
but simply traverse the north wall and lead up to the fourth floor.  The
only other exit from this room is to the south."

extra {"stairs", "stairway"}
"Apparently the stairs go up."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_3c open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
up to floor_4a descr "The stairs lead up to the fourth floor.";
ALWAYS_LIGHT
end    /* floor_3a */

                        floor_3b
title "The Top of the Tower Stairs"
descr
"&l   The spiral stair is here, leading back down to the second floor.
The only other exit from this room is to the east."

extra {"spiral stair", "stair", "stairway", "stairs"}
"The stairs spiral down, back to the lower levels of the tower."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_3c descr "The hall is there.";
down to floor_2b descr "The stairs spiral down, out of view.";
ALWAYS_LIGHT
end    /* floor_3b */

                        floor_3c
title "The Hallway"
descr
"&l   This hallway is typical of what you have seen in the rest of the
tower, with debris strewn about and dirt obscuring what might otherwise
have been a beautiful area.  The hallway continues to the east and west,
while there is a door to the north."

extra {"dirt", "debris", "grime", "filth"}
"&lThere is a lot of dirt and debris here.  And it smells.  Bad.  Someone
needs to go out and buy some Murphy's oil soap or something..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_3a open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
west to floor_3b descr "The spiral stair is there.";
east to floor_3d descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_3c */

                        floor_3d
title "The Hallway"
descr
"&l   Like the hall to the west, this passageway is covered in dirt and
debris.  There is a door to the south, and around the doorway there are
several elven carvings, although they, too, are obscured by grime."

extra {"elven carvings", "elven writing", "carvings", "writing"}
"&lAlthough these carvings are covered in a great deal of dirt and filth,
you can still make out what appear to be depictions of wise elves at
study, as well as a great deal of elven writing."

extra {"dirt", "debris", "grime", "filth"}
"&lThe amount of debris and dirt which has collected throughout the tower
indicate that no one has made any effort to maintain this structure for
a very long time."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_3h open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"door", "oak door"};
west to floor_3c descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_3d */

                        floor_3e
title "Drynmyr's Quarters"
descr
"&l   This room, like the one which you just left, has a feeling of magic
about it.  A small, circular window allows light to shine in, and underneath
the window is a comfortable-looking bed.  There is a small table next to
the bed on which a stick of incense is burning.  The only exit from this
room is back to the east."

extra {"small bed", "bed"}
"The bed is neatly made and looks very comfortable."

extra {"circular window", "window"}
"&lThe window is about four feet above the floor, and it allows light to
shine into the room."

extra {"small table", "table", "stick", "incense", "wooden frame", "frame"}
"&lThe table is only about two feet high, and is made of oak.  The incense
which is burning on it smells quite nice and is held aloft in a small
wooden frame."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_3f descr "The entrance to Drynmyr's quarters is there.";
ALWAYS_LIGHT
end    /* floor_3e */

                        floor_3f
title "The Entrance to Drynmyr's Quarters"
descr
"&l   You have entered a study room of some sorts, although it is much
more cosy than the spacious library to the east.  A desk is on the southern
wall, and it is covered by several ancient books.  There are two shelves on
the northern wall on which even more books are located.  Also located on the
desk is a pile of manuscripts and what appear to be Drynmyr's notes.  The
room continues to the west."

extra {"desk", "southern wall"}
"&lThe desk is located on the south wall and appears to be made of very old
oak."

extra {"ancient books", "books", "shelves", "northern wall"}
"&lThe books which are located on the desk and on the shelves radiate an aura
of magic... perhaps it would be best to leave them alone."

extra {"manuscripts", "drynmyr's notes", "notes"}
"&lThe manuscripts are apparently the records of individuals who are now long
dead, but their subject eludes you.  The notes are obviously Drynmyr's,
and you infer from them that he is seeking the solution to an important
problem."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_MOB}
movement SECT_INSIDE
east to floor_3g open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
west to floor_3e descr "Drynmyr's quarters are there.";
ALWAYS_LIGHT
end    /* floor_3f */

                        floor_3g
title "The Library Entrance"
descr
"&l   Unlike most of the tower, this area is still in excellent condition.
The ceilings are vaulted, and rise up to a height of perhaps fifteen feet.
The stone of which the walls and ceilings are built is bright white and
very beautiful.  You see two long shelves of books, and assume that you
have entered the tower library.  There is a stillness in the air, and
you sense that you may not be alone here.  A door leads to the west,
and the library continues south."

extra {"walls", "white stone", "stone", "ceilings"}
"&lThe stone, when cleaned of dirt, is extremely beautiful and reflects the
light in a way that is so glorious that you are nearly overwhelmed.  You
wonder how this room has escaped the destruction which you have seen in the
rest of the tower..."

extra {"shelves", "books"}
"&lThe shelves are made of polished oak and contain several hundred books
each.  The books look ancient, and many of them are written in languages
which you cannot understand."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_3f open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
south to floor_3k descr "The library continues in this direction.";
east to floor_3h descr "The hallway is there.";
ALWAYS_LIGHT
end    /* floor_3g */

                        floor_3h
title "The hallway"
descr
"&l   There is noticeably less debris in this hall than in most of the
others which you have traversed.  Additionally, you notice some scattered
bones which have been pushed away against the wall.  You can only guess at
what might have happened to their former owners...  The hallway continues
east and west, and there is a door to the north."

extra {"debris", "dirt", "grime", "filth"}
"&lThe amount of dirt and debris in this hallway is significantly less than
that found in the other rooms of the tower.  Apparently the hordes which
wander Kithyrn choose to avoid this section for some reason."

extra {"scattered bones", "bones", "bone"}
"&lIt is probably a safe bet that whoever once owned these bones is no
longer around to tell you why they're now strewn on the ground..."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_3d open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
west to floor_3g descr "The hallway continues in this direction.";
east to floor_3i descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_3h */

                        floor_3i
title "The Elven Study Room"
descr
"&l   Paper, stones, and pieces of glass are strewn about the floor.  The
remains of a table and chairs are set up against the south wall, while a
large window allows light to flow into the room and looks like it might
provide an excellent view of the surrounding countryside.  This room may
at one time have been used as a room of study for the elves, although it
has been so completely vandalized as to be rendered useless.  The only
exit is back to the west."

extra {"table", "chairs", "remains", "south wall"}
"&lSomeone has apparently used an axe on this furniture, perhaps to make
firewood.  All that remain are a few boards and many splintered shards."

extra {"paper", "stones", "pieces of glass", "glass", "rubble"}
"&lThis rubble is strewn about the room in great quantity.  Some of the paper
is most likely the remains of books, although the writing is no longer
legible."

/*  ********** Note:  Be sure to keep view up to date **********  */
extra {"large window", "window", "countryside"}
"&lThis window is almost four feet high and affords you an excellent view of
the surrounding countryside.  Looking east you can make out the kindly
town of Urland, while to the northwest you see a cold arctic wasteland
hidden in a valley behind some large boulders.  Beyond this valley you
also see a very evil looking temple.  Smoke emanates from this place, and
you get the feeling that it would be best to avoid going there."

extra {"temple"}
"&lAlthough you cannot be sure, you wonder if this place might not be the
home of the evil Queen of Dragonkind, Tiamat."

extra {"valley", "arctic", "wasteland", "boulders"}
"&lThis valley looks well-hidden in the mountains north of Urland.  Maybe you
could venture there in the future."

extra {"urland", "town"}
"This town, at the end of King's Road, is always a pleasant sight."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_3h descr "The hallway is there.";
ALWAYS_LIGHT
end    /* floor_3i */

                        floor_3j
names {"western library"}
title "The Western Library"
descr
"&l   This room, like the others of the library, is clean and does not
appear to have been touch by vandals.  A table and several cosy-looking
chairs are set before a large window on the western wall, and you are
tempted to sit down and begin reading.  Light streams in through the
window, which looks like it might provide an excellent view of the
surrounding countryside.  The only exit is back to the east."

extra {"table", "chairs", "chair", "carvings", "legs", "edges", "leg"}
"&lThe table is a work of art itself, with a number of carvings on the legs
and edges..  The chairs look soft and cosy.  Maybe a short break would be
nice..."

/*  ********** Note:  Be sure to keep view up to date **********  */
extra {"large window", "window", "western wall", "wall", "countryside"}
"&lThe window is large, approximately four feet high, and provides a view
of the countryside.  Far off in the distance you can see the great city
of Midgaard, and north of Midgaard you see the moors and a vast mansion.
To the south you can see the port town of Torsbay."

extra {"midgaard", "city"}
"&lMidgaard is truly a metropolis... it extends for great distances, and
is filled with many wondrous sights."

extra {"moors", "mansion"}
"&lThe moors north of Midgaard are truly a desolate place, except for a
single mansion located just off of the road.  Perhaps this is the home
of the wizard Tobas, although you cannot be sure."

extra {"port town", "town", "torsbay"}
"&lThe town of Torsbay is definitely an interesting place, with a great
deal of activity taking place around the docks.  This may be an area
worth visiting."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_3k descr "The library continues in this direction.";
ALWAYS_LIGHT
end    /* floor_3j */

                        floor_3k
names {"main library", "library"}
title "The Main Library"
descr
"&l   There are two bookshelves here that run the length of the room and
contain books on all subjects.  On the floor is a beautifully made mosaic
which depicts the world, although it is obviously an old depiction as you
recognize very little.  Against the south wall is what appears to be a
fireplace, which is strange considering that a fire would be so dangerous
with all of these books in the room.  The only visible exits are to the
north, east, and west."

extra {"bookshelves", "books"}
"&lThe shelves are made of polished oak and contain several hundred books
each.  The books look ancient, and many of them are written in languages
which you cannot understand."

extra {"fireplace", "south wall"}
"&lIt is odd that someone would put a fireplace in a room with so many
books.  Perhaps this fireplace is not what it seems to be..."

extra {"mosaic", "floor"}
"&lThis mosaic is made out of thousands of bits of glass, shell, rock, and
many other exotic materials.  It is an amazing depiction of the world,
with various landmarks specially illustrated.  You notice a large tower
that is pictured in the northeast, and assume that it must be Kithyrn."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_3m open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
     keyword {"door", "fireplace", "exit", "south wall", "wall"}
     descr "You discover a hidden door.";
SECRET_DOOR_DIFFICULTY (SOUTH, 3)
west to floor_3j descr "The library continues in this direction.";
north to floor_3g descr "The library continues in this direction.";
east to floor_3l descr "The library continues in this direction.";
ALWAYS_LIGHT
end    /* floor_3k */

                        floor_3l
names {"eastern library"}
title "The Eastern Library"
descr
"&l   The eastern portion of the library is apparently used for studying
purposes only.  Although there are a few books on some shelves along the
north wall, the central feature of this room seems to be a large leather
couch which has been placed against the south wall.  You notice that the
light in the room is reflecting off of one of the couch cushions in a
strange manner, but otherwise there is nothing of note here.  Going west
will take you back to the main library."

extra {"shelves", "book", "books", "north wall"}
"&lTwo shelves are built into the north wall and support about fifteen
books each.  Like the other books in this library, the ones in this room
look quite ancient."

extra {"leather couch", "couch", "south wall", "leather"}
"&lThis couch is of excellent craftsmanship, a common theme in this part of
the tower.  It is large enough for perhaps four people to fit comfortably,
and the leather has been kept soft and looks inviting.  Something glints
at you from between two of the cushions -- perhaps if you searched you might
be able to discover what it is?"

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS, UNIT_FL_NO_MOB}
movement SECT_INSIDE
west to floor_3k descr "The library is there.";
ALWAYS_LIGHT

/*  Dil to give players the coffer key */
dilbegin floor3l1();
var
  item : unitptr;
  u1 : unitptr;
code {
  :start:
    wait (SFB_CMD, TRUE);
    if ((activator.type == UNIT_ST_PC) and command("search")) {
      if (("couch" in argument) or ("cushion" in argument)) {
        block;
        u1 := findunit(activator, "coffer key",
             FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
        if ((u1 == null) and (ARISTOL_ONGOING in activator.quests)) {
          act("You find a small metal key.", A_ALWAYS, self.inside, null,
               null, TO_CHAR);
          act("$1n finds a key.", A_HIDEINV, self.inside, null,
               null, TO_REST);
          item := load("coffer_key@tower");
          link(item, activator);
        }
        else {
          act("Your search is unsuccessful.  There must not be anything "+
               "there that you need.", A_ALWAYS, self.inside, null,
               null, TO_CHAR);
        }
      }
    }
    goto start;
}
dilend
end    /* floor_3l */

                        floor_3m
title "The Bare Room"
descr
"&l   The room which you now stand in is almost completely bare.  The
walls are naked stone, as is the floor and ceiling.  A single window
allows light to shine in, and the sun's rays reflecting off of the stone
creates an unusually peaceful atmosphere.  There is a strange tingle in
the air, which feels like it is magical, although somehow you sense that
it is not.  Since the room is kept secret, you guess that it is used to
hide things..."

extra {"naked stone", "stone", "walls", "wall", "floor", "ceiling"}
"&lExcept for its single circular window, this room is completely lacking
in decoration.  The stone of which the tower was constructed is all
that is here."

extra {"circular window", "window"}
"&lThe window is about six feet above the floor, and it allows light to
shine into the room."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_3k open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
ALWAYS_LIGHT
dilcopy no_magic@tower();
end    /* floor_3m */

/*          *********     The Fourth Floor     *********          */

                        floor_4a
title "The Top of the Stairs"
descr
"&l   The stairs end in a room much like those you have found throughout
the rest of the tower.  The only exits are back down to the third floor
or to the south."

extra {"stairs", "stairway"}
"Apparently the stairs go up."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
down to floor_3a descr "The stairs go down.";
south to floor_4c descr "There is a hallway there.";
ALWAYS_LIGHT
end    /* floor_4a */

                        floor_4b
title "Sarinyil's Private Room"
descr
"&l   You have entered a veritable treasure trove of elven artifacts.
Shelves on the walls of this room contain various weapons, potions, and
other artifacts which you have never before encountered.  The magic and
heritage which these items embody lends an almost mystical air to the
room.  It is no wonder that Sarinyil has remained in the tower to guard
these special items."

extra {"shelves", "walls", "shelf", "wall"}
"&lThere are three shelves on each of the north, east, and west walls.
Each shelf is perhaps ten feet long and has perhaps a dozen objects
placed upon it."

extra {"weapons", "bows", "swords", "daggers"}
"&lThe weapons that have been placed in this room are finely crafted, and you
suspect that they posess magical qualities as well.  Daggers, swords, bows,
and all other manner of weapons have been gathered, and you have no doubt
that any one of these would probably fetch a king's ransom if sold."

extra {"potions", "artifacts", "rings", "belts", "helms", "objects"}
"&lThe number of objects in this room is amazing.  Potions, rings, belts,
helms, and dozens of other objects have been gathered here.  What is most
amazing, however, is not the quantity of items, but the fine quality of the
items.  The sale of any one of these objects would probably provide enough
income to last an individual for a year or more..."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_4f descr "Sarinyil's quarters are there.";
ALWAYS_LIGHT
end    /* floor_4b */

                        floor_4c
title "The Hallway"
descr
"&l   Dirt and debris, now a common sight to you, also litters this hall.
The passage leads further south, or you can go north to the stairs.  There
is a door to the east."

extra {"dirt", "debris", "grime", "filth"}
"&lIt looks as if someone has recently rubbed mud on the walls to spell
a message.  It reads 'Zex is a freak!'  He is, too."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_4d open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
north to floor_4a descr "The stairs are there.";
south to floor_4g descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_4c */

                        floor_4d
names {"northern storeroom"}
title "The Northern Storeroom"
descr
"&l   The filth of the tower disappears as you enter this room.  This
storeroom is kept spotlessly clean, with no trace whatsoever of the grime
which you have previously encountered.  The walls, built of a bright
white stone, shine brightly, reflecting the light coming in from a
window on the north wall.  Cupboards have been placed on the eastern
wall, and a few small bins line the northern and western walls.  There are
exits to the south, and the door is to the west."

extra {"walls", "white stone", "stone"}
"&lThe stone, when cleaned of dirt, is extremely beautiful and reflects the
light in a way that is so glorious that you are nearly overwhelmed.  You
wonder why this room is so different from the rest of the tower..."

extra {"circular window", "window", "north wall", "wall"}
"&lThe window is placed about six feet above the floor, and it allows light
to shine into the room."

extra {"bins", "roots", "powders", "herbs", "northern wall", "western wall"}
"&lThese bins are made of cedar wood and contain various roots, powders,
and herbs."

extra {"cupboards", "eastern wall", "items", "linens", "containers"}
"&lThe two cupboards on the eastern wall contain various necessities of life.
The one closer to the north wall is full of small containers, each holding
a number of various and sundry items.  The other cupboard contains several
different colors of linens."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_4c open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
south to floor_4h descr "The storeroom continues in this direction.";
ALWAYS_LIGHT
end    /* floor_4d */

                        floor_4e
title "Sarinyil's Quarters"
descr
"&l   Sarinyil's bed is placed here against the western wall, directly
beneath a circular window.  Next to the bed is an ancient painting of
a stately elf who you assume to be one of Sarinyil's relatives, perhaps
her father.  Nothing in this room is in disorder, and the only other
object of notice is an oil lamp which burns on a stand next to the bed."

extra {"small bed", "bed"}
"The bed is neatly made and looks very comfortable."

extra {"circular window", "window"}
"&lThe window is about six feet above the floor, and it allows light to shine
into the room."

extra {"ancient painting", "painting", "stately elf", "elf", "father"}
"&lThe elf who is portrayed is perhaps six feet tall with sandy brown hair
that flows down around his shoulders.  His green eyes shine at you in
a friendly greeting which feels comforting despite the bright sword that
hangs at his side."

extra {"oil lamp", "stand", "lamp"}
"The lamp and stand are both quite ordinary."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to floor_4f descr "Sarinyil's Quarters are there.";
ALWAYS_LIGHT
end    /* floor_4e */

                        floor_4f
title "The Entrance to Sarinyil's Quarters"
descr
"&l   The room in which you now find yourself is obviously someone's
living quarters, and is obviously still inhabited.  A comfortable looking
chair sits at a desk against the eastern wall with papers neatly stacked on
one corner.  An easel is also here, with a half-finished canvas upon it.
These quarters continue to the north and west, and the door is to the south."

extra {"easel", "canvas", "painting", "landscape"}
"&lThe easel is simply a wooden frame which has been lashed together and
placed near the wall.  The canvas upon it is a work in progress, although
it appears to be a landscape painting.  Although the painting is far from
finished you recognize it as the work of a truly talented artist."

extra {"chair"}
"Dude, it's just a chair.  What did you expect to be special about it?  Are
you really into furniture or something?  If that's the case, there's a
couch on the third floor, a desk on the second, a bedstand on the first..."

extra {"desk", "papers", "eastern wall"}
"&lThe desk is rather unremarkable, although you recognize the papers upon
it to be the rough draft of a novel of some sorts.  On some of the papers
are illustrations of elves, a giant dragon, humans, and other scenes from
the world's past... apparently Sarinyil is working on a history of this
land."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_4j open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"door", "oak door"};
west to floor_4e descr "Sarinyil's sleeping quarters are there.";
north to floor_4b descr "Sarinyil's quarters continue in this direction.";
ALWAYS_LIGHT
end    /* floor_4f */

                        floor_4g
title "The hallway"
descr
"&l   The hallway comes to a dead end at this point.  As in other places,
dirt and grime cover the walls, ceiling, and floor.  There is more rubble
here than in other parts of the tower, but otherwise there is nothing
unusual about this area.  Your only exit is back to the north."

extra {"rubble", "junk", "southeast corner", "corner"}
"&lThere are bits of stone, glass, and metal scattered all over the floor
here.  Someone has collected some of it into a pile in the southeast
corner, and you notice that the light seems to be glinting off of something
buried here."

extra {"light", "pile"}
"&lTry 'search pile', dude."

extra {"dirt", "grime", "filth", "floor", "ceiling", "walls", "wall"}
"&lIt's really dirty here... in fact, it's so bad that you can hardly
keep from puking.  The one thought that helps you hold down your lunch is
that somewhere, somehow, Dax is probably eating some nasty microwave
pizza crap, and if he can keep that down, you ought to be able to keep your
lunch down, too."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_4c descr "The hallway continues in this direction.";
ALWAYS_LIGHT

/*  Dil to give players the medallion */
dilbegin floor4g1();
var
  item : unitptr;
  u1 : unitptr;
code {
  :start:
    wait (SFB_CMD, TRUE);
    if ((activator.type == UNIT_ST_PC) and command("search")) {
      if (("pile" in argument) or ("rubble" in argument)) {
        block;
        u1 := findunit(activator, "bronze medallion",
             FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
        if ((u1 == null)) {
          act("You find a bronze medallion.", A_ALWAYS, self.inside, null,
               null, TO_CHAR);
          act("$1n finds a medallion.", A_HIDEINV, self.inside, null,
               null, TO_REST);
          item := load("bronze_medallion@tower");
          item.height := activator.height;
          link(item, activator);
        }
        else {
          act("Your search is unsuccessful.  There must not be anything "+
               "there that you need.", A_ALWAYS, self.inside, null,
               null, TO_CHAR);
        }
      }
    }
    goto start;
}
dilend
end    /* floor_4g */

                        floor_4h
names {"main storeroom"}
title "The Main Storeroom"
descr
"&l   Like the room before it, this room is immaculately clean.  The aromas
of meats, cheeses, and vegetables linger in the air here.  Several large
barrels are set up along the western wall, while the meats, cheeses, and
vegetables which you smell are hanging by cords from the ceiling.  Sacks
of flour, grains, and other staples are piled in the southwest corner.
Exits from this room are to the north and east, and there is a door to the
south."

extra {"barrels", "western wall"}
"&lThe barrels are labeled 'molasses', 'oil', 'water', and 'wine'.  Each
is tightly sealed except for the 'wine' barrel, which seems to be opened."

extra {"meats", "cheeses", "vegetables", "ceiling", "cords"}
"&lDried meats, cheeses, and vegetables are hanging from the ceiling.  Your
mouth waters as you stare at these delicacies, but unfortunately you are
unable to reach them."

extra {"sacks", "flour", "grains", "staples", "southwest corner", "corner"}
"&lSacks, each labeled with its contents, are piled in the southwest
corner.  Grains, flour, sugar, and many other dry-goods all seem to be
present."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_4l open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
north to floor_4d descr "The northern storeroom is there.";
east to floor_4i descr "The storeroom is there.";
ALWAYS_LIGHT
end    /* floor_4h */

                        floor_4i
names {"eastern storeroom"}
title "The Eastern Storeroom"
descr
"&l   A huge number of wooden crates are stored in this room.  The crates
have been piled one on top of another along the northern and southern walls
and reach from the floor to the ceiling.  The only remaining floorspace in
the room is a narrow path that leads to a window on the eastern wall.  The
only exit is back to the west."

extra {"circular window", "window", "eastern wall", "statue"}
"&lThe window is about six feet above the floor, and it allows light to shine
into the room.  Underneath the window you notice a small statue of Pope John
Paul IV.  You also notice that Zex has apparently scribbled his name onto
the base of the statue along with the words 'Hehehe!  They'll never know
it's me!  Hehehe...'"

extra {"crate", "crates", "pile", "northern wall", "southern wall"}
"&lThe crates obviously store items which are used within the tower.  There
are a variety of sizes in the room, but the average one seems to be
about four feet long by two feet wide."

extra {"narrow path", "path", "floorspace"}
"&lA small amount of floorspace has apparently been kept clear to allow
individuals to pass through the room."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to floor_4h descr "The main storeroom is there.";
ALWAYS_LIGHT
end    /* floor_4i */

                        floor_4j
title "The Hallway"
descr
"&l   The hall stops here before a simple oak door.  However, despite its
simple construction, you get the feeling that there may be something
special behind this door.  A window on the western wall allows light to
shine in, and, like in the hall to the east, you notice that there are no
shadows whatsoever.  Exits from this hall are to the east or through the
door to the north."

extra {"circular window", "window", "western wall"}
"&lThe window is about six feet above the floor, and it allows light to shine
into the room."

extra {"walls", "floor", "wall", "stone"}
"The walls and floor are bare stone, with no ornamentation whatsoever."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_4f open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"door", "oak door"};
east to floor_4k descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_4j */

                        floor_4k
title "The Hallway"
descr
"&l   Like the hall to the east, this corridor is bare.  The stone of
which the tower was constructed is all that is here.  Light bounces off of
the walls and floor in a somewhat peculiar manner, leaving no shadows
whatsoever.  The hall continues to the west and east while Lorimar's
quarters are to the south."

extra {"walls", "floor", "wall", "stone"}
"The walls and floor are bare stone, with no ornamentation whatsoever."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to floor_4m open {EX_OPEN_CLOSE} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
west to floor_4j descr "The hallway continues in this direction.";
east to floor_4l descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_4k */

                        floor_4l
title "The Hallway"
descr
"&l   This hall is bare except for a circular window on the eastern wall
which allows light to shine in.  The walls and floor are the same stone
that you have seen throughout the tower, although it is kept much cleaner
than in other areas.  The hall continues to the west, while the storeroom
is to the north."

extra {"circular window", "window", "eastern wall"}
"&lThe window is about six feet above the floor, and it allows light to shine
into the room."

extra {"walls", "floor", "wall", "stone"}
"The walls and floor are bare stone, with no ornamentation whatsoever."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_4h open {EX_OPEN_CLOSE, EX_CLOSED} descr
     "There is a door made of sturdy oak here." keyword {"door", "oak door"};
west to floor_4k descr "The hallway continues in this direction.";
ALWAYS_LIGHT
end    /* floor_4l */

                        floor_4m
title "Lorimar's Sleeping Quarters"
descr
"&l   A large featherbed is set against the southern wall underneath a
small window and there is a desk which set against the northern wall,
but otherwise this room is bare.  There are no books, no pictures, nor
any other form of decoration present.  Except for its cleanliness and
the sheets on the bed it looks almost like no one had been living in
this room for a very long time."

extra {"desk", "northern wall"}
"&lThe desk is completely bare and has obviously remained unused for a very
long time."

extra {"circular window", "window"}
"&lThe window is about six feet above the floor, and it allows light to shine
into the room."

extra {"featherbed", "bed", "southern wall"}
"&lThe sheets on the bed are fresh, and the bed looks like someone has been
using it.  Although Lorimar does not seem to like decorations in his
quarters, he obviously still enjoys a good night's sleep."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to floor_4k open {EX_OPEN_CLOSE} descr
     "There is a door made of sturdy oak here." keyword {"oak door", "door"};
ALWAYS_LIGHT
end    /* floor_4m */

/*           *********     Below the Tower     *********           */

                        under_entry
title "The Stairs Leading Under the Tower"
descr
"&l   The outside sunlight disappears into an eerie blue glow as you
descend the stairs into the tower's lower regions.  The passage here is
built entirely out of a stone which resembles marble, but due to the
lighting it is difficult to tell for sure what its actual composition
might be.  You guess that these stairs might perhaps lead twenty feet
under the ground, and you can not be sure of what might lie ahead."

extra {"white stone", "stone", "wall", "walls", "stairs", "ceiling"}
"&lThe walls, stairs, and ceiling of this passage are all constructed of a
white stone.  You are surprised at the cleanliness of this area-- it seems
that there should at least be some dust covering things, yet even that is
absent."

extra {"eerie blue glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

flags {UNIT_FL_NO_MOB, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
up to tower_north open {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED}
     key basement_key
     descr "There is a door there." keyword {"door"};
south to under_passage1 descr "The passage levels out up ahead.";
ALWAYS_LIGHT
end    /* under_entry */

                        under_passage1
title "A Passageway Under the Tower"
descr
"&l   The passage is level here, and the eerie glow which you noticed
before is now the only source of light.  The ceilings in this passageway
are about ten feet high, and the corridor you are in is perhaps eight
feet wide.  There is nothing of note here, except for some unusual
geometric patterns which have been carved into the stone of the walls.
Exits are to the north and south."

extra {"geometric patterns", "patterns", "walls", "wall", "stone"}
"&lDiamonds, squares, triangles, and other shapes have been carved into the
stone walls in a rather artistic manner..  Taken as a whole, the collection
of these shapes is quite beautiful."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"ceiling", "corridor"}
"&lThe ceiling of this passage is about ten feet high and made of stone.
The corridor which you stand in is made of the same stone but only about
eight feet wide."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
south to under_passage2 descr "There is a junction ahead.";
north to under_entry descr "The stairs leading back up are there.";
ALWAYS_LIGHT
end    /* under_passage1 */

                        under_passage2
title "A Junction in the Passage"
descr
"&l   The passage splits into three at this point.  Separate corridors
lead north, east, and west.  The wall to the south is covered by rather
ornate elven writing, although with the available light it might be
difficult to read."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"ornate elven writing", "elven writing", "writing", "story"}
"&lIn the dim light this writing is difficult to make out, but it seems to
be a story involving an elf who long ago found an object of great power,
and how he fought to bring this object back to his fellow elves."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
north to under_passage1 descr "This direction leads back to the surface.";
east to under_stairs1 descr "It is difficult to see what may be there.";
west to under_passage3 descr "It is difficult to see what may be there.";
ALWAYS_LIGHT
end    /* under_passage2 */

                        under_passage3
title "A Passageway Under the Tower"
descr
"&l   The blue glow which illuminates the passages intensifies slightly
at this point, but otherwise there is nothing too unusual about this
corridor.  The same geometric patterns which you noticed earlier are
also present here in the stone of the walls.  The passage continues east
and west."

extra {"geometric patterns", "patterns", "walls", "wall", "stone"}
"&lDiamonds, squares, triangles, and other shapes have been carved into the
stone walls in a rather artistic manner.  Taken as a whole, the collection
of these shapes is quite beautiful."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to under_passage2 descr "It is difficult to tell what may be there.";
west to under_chamber1 descr "It is difficult to tell what may be there.";
ALWAYS_LIGHT
end    /* under_passage3 */

                        under_chamber1
title "A Circular Chamber"
descr
"&l   The blue glow in the air is definitely stronger in this room,
illuminating everything with nearly the same intensity as sunlight.
The room is circular in shape, and there is an important-looking
pyramid-shaped object at its center.  Elven runes are on all of the
walls, and the many pictures which have been carved suggest that this
room may have been used for some sort of religious purposes at one
time.  The only visible exit is back to the east."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides nearly as
much light as would be found outside."

extra {"elven runes", "walls", "runes", "carvings", "pictures"}
"&lAlthough you are unable to read the ancient writing, the pictures which
have been carved into the walls seem to follow two themes.  Many of the
pictures depict an elf in battles, apparently trying to return to Kithyrn.
The remaining pictures are of elves who seem to be meditating.  All of
these elves are depicted in the seated position with an aura surrounding
them."

extra {"pyramid-shaped object", "pyramid", "object", "inscription"}
"&lThis pyramid-shaped object is obviously the focus of the room.  It
stands about six feet tall and is perhaps four feet wide at the base.
It is built out of a shiny black stone, and is decorated with various
bronze inlays.  There is an inscription at its base which reads:

      'Those who seek the key to the path of knowledge, be
      seated and it shall come to you.'"

extra {"bronze inlays", "inlays", "bronze", "geometric patterns", "patterns"}
"&lThe bronze inlays on the pyramid are the same geometric patterns which you
noticed on the walls of the passages which led you here."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to under_passage3 descr "The passageway is there.";
ALWAYS_LIGHT

/*  Dil to give players the obsidian shard */
dilbegin under_chamber11();
var
  pc   : unitptr;
  u1   : unitptr;
  item : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_SIT)));
    pc := activator;
    secure(pc, lostpc);
    u1 := findunit(pc, "obsidian piece",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    if (not(u1 #= null)) {
      act("You have what you require.  Go about your journeys.",
           A_ALWAYS, self.inside, null, null, TO_CHAR);
      unsecure(pc);
      goto start;
    }
    if (not(DRYNMYR_ONGOING in pc.quests)) {
      pause;
      act("You are not ready for the trials which lie ahead.  Return "+
           "after you have sought counsel from the tower elves.",
           A_ALWAYS, self.inside, null, null, TO_CHAR);
    }
    else {
      pause;
      act("The blue glow in the room intensifies slightly, and a crack "+
           "appears in the pyramid.  As the crack widens, a piece of "+
           "obsidian breaks off and falls to the ground.", A_ALWAYS,
           self.inside, null, null, TO_ALL);
      item := load("obsidian_piece@tower");
      link(item, findroom("tower/under_chamber1"));
      pause;
      act("A voice echoes in your head saying, 'Take this obsidian piece, "+
           "and continue in your journey.'", A_ALWAYS, self.inside, null,
           null, TO_CHAR);
    }
    unsecure(pc);
    goto start;
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* under_chamber1 */

                        under_stairs1
title "The Top of the Stairs"
descr
"&l   The passageway ends here in a set of stone stairs which lead down.
The blue glow of the air and geometric patterns carved into the walls
are still here, and you also notice that your skin is tingling slightly,
although you cannot find any cause for this sensation."

extra {"geometric patterns", "patterns", "walls", "wall", "stone"}
"&lDiamonds, squares, triangles, and other shapes have been carved into the
stone walls in a rather artistic manner.  Taken as a whole, the collection
of these shapes is quite beautiful."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"stone stairs", "stairs", "stairway"}
"&lThey're stairs.  You might have seen a set once or twice in your life.
Pretty spiffy things, stairs.  They generally go up and down, and, what do
you know, these are no exception!  Indulge yourself!  Go up AND down the
stairs!  Be a wild man!  Why the hell am I sitting here programming at two
o'clock in the morning?"

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to under_passage2 descr "There is an intersection of passages there.";
down to under_stairs2 descr "It is difficult to tell what may be there.";
ALWAYS_LIGHT
end    /* under_stairs1 */

                        under_stairs2
title "The Bottom of the Stairs"
descr
"&l   The stone stairs which lead back up are here.  This level of the
tower does not look like it was meant for visitors.  Runes carved on the
walls look very ancient and seem somehow to radiate a sense of sacredness.
The ceiling here is slightly lower, and the corridor is more narrow than
that which was above.  Additionally, there is an unusual tingle in the air,
although you have no idea what it might be or what might be causing it."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"stone stairs", "stairs", "stairway"}
"&lThe stairs are made of the same stone that everything in this area is
built from and lead back up to the first level."

extra {"elven runes", "carvings", "sacred runes", "runes", "walls"}
"&lThese carvings are not as sharply defined as others you have seen,
indicating that they have been worn down somewhat by the passage of time.
They are obviously terribly old, and something about them gives you the
idea that they were not meant to be seen by visitors."

extra {"corridor", "ceiling"}
"&lThe ceiling is slightly lower here than it was above, and the corridor
is most definitely more narrow."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
up to under_stairs1 descr "The top of the stairs is there.";
east to under_passage4 descr "It is difficult to tell what may be there.";
ALWAYS_LIGHT

/*  Dil to test for proper quest flags */
dilbegin under_stairs21();
var
  pc : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC));
    pc := activator;
    secure(pc, lostpc);
    if ((DRYNMYR_ONGOING in pc.quests) or (KITHYRN_COMPLETE in pc.quests)) {
      pause;
    }
    else {
      act("A voice echoes in your head saying, 'You are not ready "+
           "for the trials which lie ahead.  Return after you have "+
           "sought counsel from the tower elves.'",
           A_ALWAYS, self.inside, null, null, TO_CHAR);
      act("An intense blue glow envelops "+ pc.name +", transporting them "+
           "out of this section of the tower.", A_HIDEINV, self.inside,
           null, null, TO_REST);
      link(pc, findroom("tower/before_tower"));
      exec("look", pc);
      act(pc.name+" has arrived.", A_HIDEINV, self.inside,
           null, null, TO_REST);
      unsecure(pc);
      goto start;
    }
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* under_stairs2 */

                        under_passage4
title "A Passageway Under the Tower"
descr
"&l   The passage continues eastward towards a door.  The runes on the
wall look even older here, and you also notice that a few pictures have
been carved into the stone of the walls.  The blue glow in the air seems
to be getting slightly stronger, and the tingle in the air is definitely
more pronounced."

extra {"elven runes", "carvings", "sacred runes", "runes", "walls"}
"&lThese runes are not as sharply defined as others you have seen,
indicating that they have been worn down somewhat by the passage of time.
They are obviously terribly old, and something about them gives you the
idea that they were not meant to be seen by visitors."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"pictures"}
"&lThe pictures are of an elf facing many struggles in a journey to reach
what appears to be Kithyrn tower."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to under_passage5 open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_PICKPROOF}
     key basement_key
     descr "There is a door there." keyword {"door"};
west to under_stairs2 descr "The bottom of the stairs is there.";
ALWAYS_LIGHT
dilcopy no_magic@tower();
end    /* under_pasage4 */

                        under_passage5
title "A Passageway Under the Tower"
descr
"&l   The tingle in the air which you have noticed is now so strong that
you feel it as a sort of electric touch.  The blue glow of the air is
also becoming stronger, and the carvings on the wall are definitely
beginning to look much older.  This area of the tower is obviously a
very special one, and you wonder if it is a good idea for any but the
tower elves to be here..."

extra {"elven runes", "carvings", "sacred runes", "runes", "walls"}
"&lThese runes are not as sharply defined as others you have seen,
indicating that they have been worn down somewhat by the passage of time.
They are obviously terribly old, and something about them gives you the
idea that they were not meant to be seen by visitors."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to under_passage4 open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_PICKPROOF}
     key basement_key
     descr "There is a door there." keyword {"door"};
east to under_passage6 descr "It is difficult to tell what may be there.";
ALWAYS_LIGHT
end    /* under_passage5 */

                        under_passage6
title "A Passageway Under the Tower"
descr
"&l   The passage comes to an end at this point.  The tingle in the air
and the blue glow which surround you are now very intense, and the wall
carvings are definitely older than anything which you have yet encountered.
A stone statue has been placed against the eastern wall, and next to it
are a series of very unusual markings."

extra {"elven runes", "carvings", "sacred runes", "runes", "walls"}
"&lThese runes are not as sharply defined as others you have seen,
indicating that they have been worn down somewhat by the passage of time.
They are obviously terribly old, and something about them gives you the
idea that they were not meant to be seen by visitors."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lYou have no idea where the illumination for this passage is coming from.
There are no light sources, yet a blue glow in the air provides enough
light for you to see by."

extra {"stone statue", "statue", "elf", "inscription", "eastern wall"}
"&lThe statue is of the elf who you have seen in many of the wall carvings.
He stands as tall as you, and wears the garb of one who is travelling.
Cradled in his right arm is a pouch which he is obviously guarding, while
his left hand clutches a staff which looks similar to those magicians
carry.  At the base of the statue is an inscription which reads:

     'Continue onward only those of purest heart, for the
     secrets of the tower elves were not meant to be known
     by any but the truest of individuals.  For those who
     are worthy, search and you shall find the path.'"

extra {"unusual markings", "markings", "geometric patterns", "patterns"}
"&lThe markings are actually a much more complex arrangement of the
geometric patterns which you noticed on the first level.  The many
shapes on this wall come together to form a star, the center of which
looks suspiciously like it might be hiding something..."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
east to under_passage7 open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_HIDDEN,EX_PICKPROOF}
     key obsidian_piece
     keyword {"door", "star's center", "star", "center"}
     descr "You discover a door which has been hidden amidst the shapes.";
SECRET_DOOR_DIFFICULTY (EAST, 3)
west to under_passage5 descr "The passageway continues in this direction.";
ALWAYS_LIGHT
dilcopy no_magic@tower();
end    /* under_passage6 */

                        under_passage7
title "The End of the Passageway"
descr
"&l   The passage expands to form a large chamber here.  The blue glow in
the air is very intense, and you now begin to wonder if the tingle in the
air might somehow be related to it.  The room you are in is square in
shape, and on the walls are a series of carvings which depict an elf in
his travels.  The series of pictures seems to begin and end on the
southern wall, with the intermediate stages on the western, northern,
and eastern walls respectively."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lThe glow is the same as you have noticed throughout the passages, yet
it is much, much more intense in this room.  The tingle which you have
felt in the air now seems like it might perhaps be connected with the
glow, although you can not say in what manner this might be..."

extra {"elf", "pictures", "carvings", "walls", "wall"}
"&lThe pictures depict an elf in various stages of a journey.  He is shown
leaving a tower, traveling the lands, finding something, and then fighting
to return this object to the tower.  The pictures begin and end on the
southern wall.  Actually, upon closer inspection, it looks like there
might be some special significance to the south wall..."

extra {"western wall", "northern wall", "eastern wall"}
"&lThese three walls depict various stages of the elf's journey.  The western
wall is devoted primarily to his leaving, the northern wall to his
discovery, and the eastern wall to his journies home."

extra {"southern wall", "south wall"}
"&lThe southern wall is both a beginning and an ending point for the series
of carvings.  You notice an opening at the center of the wall which glows
a bright blue color... perhaps you might be able to enter it?"

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
west to under_passage6 open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_PICKPROOF}
     key obsidian_piece
     descr "There is a door there." keyword {"door"};
ALWAYS_LIGHT

/*  Dil to gain entry into under_chamber2 */
/*  Dil modified from that in link room, created by A. Cowan (Icculus) */
dilbegin under_passage71();
var
  pc : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*5;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_ENTER)));
    if (("opening" in argument) or ("southern wall" in argument) or
         ("south wall" in argument)) {
      pc := activator;
      secure(pc, lostpc);
      block;
      act("You enter the opening.", A_ALWAYS, self.inside, null,
           null, TO_CHAR);
      act(pc.name+" enters the opening.", A_HIDEINV, self.inside, null,
           null, TO_REST);
      pause;
      link(pc, findroom("tower/under_chamber2"));
      exec("look", pc);
      act(pc.name+" has arrived.", A_HIDEINV, self.inside,
           null, null, TO_REST);
      unsecure(pc);
      goto start;
    }
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* under_passage7 */

                        under_chamber2
title "The Room With No Exits"
descr
"&l   The opening which you came in through closes behind you as you
enter this room, and you immediately see that there are no other exits.
You are trapped in a room which practically pulses with energy.  The
blue glow of the air has become nearly blinding, and what was once just
a tingle in the air is now a rather uncomfortable electric feeling.
The room itself is bare except for a stone cube at its center.  As you
desperately begin searching for a way out, the thought occurs to you
that this room could be your burial crypt..."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lThe glow is the same as you have noticed throughout the passages, yet
it is much, much more intense in this room.  The light reflects off of
all of the stone in the room and becomes almost painful to look at."

extra {"walls", "floor", "ceiling", "wall"}
"&lThe walls, ceiling, and floor are made of solid stone and do not look
like they will offer any way out of here."

extra {"stone cube", "black stone", "stone", "cube", "hole", "keyhole"}
"&lThe stone is cubical in shape and about three feet long on each side,
but otherwise there does not seem to be anything special about it.  It
is made of a deep black stone that might perhaps be obsidian.  As you
are about to turn away from it, you notice that the light in the room
is reflecting off of a small hole on one side of the cube... might this
hole perhaps be a keyhole?"

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
ALWAYS_LIGHT

/*  Dil to unlock stone cube, thus gaining a clue to enter next room */
dilbegin under_chamber21();
var
  pc : unitptr;
  u1 : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*5;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_UNLOCK)));
    if (("stone cube" in argument) or ("cube" in argument) or
         ("stone" in argument)) {
      pc := activator;
      secure(pc, lostpc);
      block;
      u1 := findunit(pc, "obsidian piece",
           FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
      if (u1 #= null) goto failure;
      act("The obsidian piece fits easily into the hole and turns "+
           "without resistance.", A_ALWAYS, self.inside, null, null,
           TO_CHAR);
      pause;
      act("After a moment a section of the cube slides away, revealing "+
           "some writing underneath.  It reads:  'For those who search, "+
           "merely speak the name of that which you seek, and the path "+
           "shall be shown you.'", A_ALWAYS, self.inside, null, null,
           TO_ALL);
      pause; pause;
      act("The panel on the stone slides back into place.", A_ALWAYS,
           self.inside, null, null, TO_ALL);
      unsecure(pc);
      goto start;
    }
  :failure:
    act("You do not have the proper key.", A_ALWAYS, self.inside,
         null, null, TO_CHAR);
    act(pc.name +" is unable to unlock the stone cube.", A_HIDEINV,
         self.inside, null, null, TO_REST);
    unsecure(pc);
    goto start;
  :lostpc:
    pause;
    goto start;
}
dilend

/*  Dil to block shouts, thus preventing players from 'cheating.' */
/*  Dil modified from that in Asgaard, written by Andrew Cowan (Icculus) */
dilbegin under_chamber22();
code {
  :start:
    wait (SFB_CMD, TRUE);
    if ((activator.type == UNIT_ST_PC) and command(CMD_SHOUT)) {
      act("Shouting is forbidden while in this room, lest you disturb "+
           "the peaceful atmosphere.", A_ALWAYS, self.inside, null, null,
           TO_ALL);
      block;
    }
    goto start;
}
dilend

/*  Dil to transfer players to under_chamber3 */
/*  Dil modified from that in link room, created by A. Cowan (Icculus) */
dilbegin under_chamber23();
var
  pc   : unitptr;
  u1   : unitptr;
  item : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_SAY)));
    if (("elven star" in argument) or ("shard" in argument)) {
      block;
      pc := activator;
      secure(pc, lostpc);
      u1 := findunit(pc, "obsidian piece",
           FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
      if (not(DRYNMYR_ONGOING in pc.quests) or (u1 #= null)) {
        pause;
        act("A voice echoes in your head saying 'You are not fully "+
             "prepared for what lies ahead.  Return when you are "+
             "ready.'", A_ALWAYS, self.inside, null, null,
             TO_CHAR);
        pause;
        act("The room around you suddenly flashes, and it is a few "+
             "moments before you realize you are in a new place.",
             A_ALWAYS, self.inside, null, null, TO_CHAR);
        act("An intense blue glow envelops "+ pc.name +", carrying them "+
             "out of this section of the tower.", A_SOMEONE, self.inside,
             null, null, TO_REST);
        pause;
        link(pc, findroom("tower/before_tower"));
        exec("look", pc);
        act(pc.name+" has arrived.", A_HIDEINV, self.inside,
             null, null, TO_REST);
        unsecure(pc);
        goto start;
      }
      else {
        act("The blue glow in the room begins to pulse, and you notice "+
             "that you, too, now seem to be glowing.", A_ALWAYS,
             self.inside, null, null, TO_CHAR);
        act("The blue glow in the room begins to pulse, and you notice "+
             "that "+pc.name +" too, now seem to be glowing.", A_HIDEINV,
             self.inside, null, null, TO_REST);
        pause; pause;
        act("The room around you suddenly flashes, and it is a few "+
             "moments before you realize you are in a new area.",
             A_ALWAYS, self.inside, null, null, TO_CHAR);
        act("An intense blue glow envelops "+ pc.name +", carrying them "+
             "out of this section of the tower.", A_SOMEONE, self.inside,
             null, null, TO_REST);
        pause;
        link(pc, findroom("tower/under_chamber3"));
        exec("look", pc);
        act(pc.name+" has arrived.", A_HIDEINV, self.inside,
             null, null, TO_REST);
        unsecure(pc);
        goto start;
      }
    }
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* under_chamber2 */

                        under_chamber3
title "The Chamber of the Elven Star"
descr
"&l   At last you have reached your goal.  The elven star is set upon a
small pedestal against the southern wall of this room.  The energy which
this object radiates is tremendous, and you realize that it is this
jewel which has been causing the tingling sensation which you noticed in
the passages, as well as the blue glow which illuminated your path.  As
you move to seize this ancient elven artifact, you suddenly realize that
you are unable to move -- something is holding you here motionless, and
until you are released there is absolutely nothing you can do..."

extra {"eerie glow", "blue glow", "glow", "light", "illumination"}
"&lThis glow is strongest around the elven star, indicating that the jewel
is the cause of this light.  The electric feeling which you noticed
earlier also seems to emanate from this jewel."

extra {"walls", "floor", "ceiling", "wall", "stone"}
"&lThe stone of which the walls, floor, and ceiling are constructed reflects
the intense blue glow of the elven star, but otherwise there is nothing
special about it."

extra {"pedestal", "southern wall"}
"The elven star is set upon a pedestal on the southern wall."

extra {"elven star", "star"}
"&lThe elven star is extraordinary -- it radiates tremendous energy, and the
blue glow which seems to emanate from it is terribly intense.  Due to
this glow you are unable to look at the gem for any length, but the few
glimpses you are able to get fill you with a sense of wonder at the
beauty of this artifact."

flags {UNIT_FL_NO_TELEPORT, UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
ALWAYS_LIGHT

/*  Dil to give players the shard, and then transfer them to before_tower */
dilbegin under_chamber31();
var
  pc   : unitptr;
  u3   : unitptr;
  u4   : unitptr;
  item : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*5;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC));
    pc := activator;
    secure(pc, lostpc);
    if (not(DRYNMYR_ONGOING in pc.quests)) {
      pause; pause;
      act("A voice echoes in your head saying, 'You must see Drynmyr "+
           "before you may be rewarded.", A_ALWAYS, self.inside, null,
           null, TO_CHAR);
      goto transfer;
    }
    else {
      pause; pause; pause; pause; pause;
      act("The blue glow in the room begins pulsing in a rhythmic "+
           "pattern.  As it begins to subside, you hear a calm voice "+
           "say 'Welcome traveler, you have come to the end of your "+
           "journey.'", A_ALWAYS, self.inside, null, null, TO_CHAR);
      pause;
      act("'"+pc.name+", you are indeed worthy to carry a piece of the "+
           "elven star.  Few have ever earned this right.'", A_ALWAYS,
           self.inside, null, null, TO_ALL);
      pause;
      act("The elven star emits a slight hum, and a small piece of it "+
           "breaks off, falling into your hands.", A_ALWAYS,
           self.inside, null, null, TO_CHAR);
      act("The elven star emits a slight hum, and a small piece of it "+
           "breaks off, falling into "+ pc.name +"'s hands.", A_SOMEONE,
           self.inside, null, null, TO_REST);
      item := load("star_shard@tower");
      link(item,pc);
      pause;
      u3 := findunit(pc, "obsidian piece",
           FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
      u4 := findunit(pc, "basement key",
           FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
      if ((u3 #= null) and (u4 #= null)) {
        goto transfer;
      }
      else {
        act("'And now, to prevent others from invading this sacred place, "+
             "we must take back the keys to this most guarded area.'",
             A_ALWAYS, self.inside, null, null, TO_CHAR);
        pause;
        u3 := findunit(pc, "obsidian piece",
             FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
        if (not(u3 #= null)) {
          act("Your obsidian shard disappears in a blue flash.",
               A_ALWAYS, self.inside, null, null, TO_CHAR);
          act(pc.name +"'s obsidian shard disappears in a blue flash.",
               A_SOMEONE, self.inside, null, null, TO_REST);
          destroy(u3);
          pause;
        }
        u4 := findunit(pc, "basement key",
             FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
        if (not(u4 #= null)) {
          act("Your basement key disappears in a blue flash.",
               A_ALWAYS, self.inside, null, null, TO_CHAR);
          act(pc.name +"'s basement key disappears in a blue flash.",
               A_SOMEONE, self.inside, null, null, TO_REST);
          destroy(u4);
          pause;
        }
      }
    }
  :transfer:
    pause; pause;
    act("'Now, "+pc.name+", it is time for you to go.'", A_ALWAYS,
         self.inside, null, null, TO_CHAR);
    pause;
    act("The blue glow of the air gathers around you, enveloping you "+
         "completely.", A_ALWAYS, self.inside, null, null, TO_CHAR);
    act(pc.name+"is enveloped by the blue glow of the air.",
         A_SOMEONE, self.inside, null, null, TO_REST);
    pause;
    act("The room around you suddenly flashes, and it is a few "+
         "moments before you realize you are in a new area.",
         A_ALWAYS, self.inside, null, null, TO_CHAR);
    act(pc.name +" disappears into the blue glow.", A_HIDEINV,
         self.inside, null, null, TO_REST);
    pause;
    link(pc, findroom("tower/before_tower"));
    exec("look", pc);
    act(pc.name+" has arrived.", A_HIDEINV, self.inside,
         null, null, TO_REST);
    unsecure(pc);
    goto start;
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* under_chamber3 */

                        floor_4n
title "Kira's Room"
descr
"&l   You're in Kira's room, which is a place that was built only because
there are times when Kira wants to mud, but not with everyone else.  Kind
of snotty of her, huh?  Anyways, if you're here, you're either a welcome
guest, or, if you don't know how you got here, you've probably discovered
some sort of bug and it would probably be a good idea for you to report it.
     The room itself contains a myriad of objects.  The most prominent of
these objects is an artichoke-covered shrine that is set against the south
wall.  On either side of the shrine are life-sized, autographed, stand-up
posters of Kyt and Zex.  Next to these, hanging on the wall, is a framed
letter from Dax.  On the eastern wall you notice a signed picture from
Icculus, and also a great snapshot of Spankii turning a lizard into mashed
potatoes.  However, the object that takes your breath away is a limited
edition Sky the God action figure that is sitting on a shelf on the western
wall.  If only everyone could be lucky enough to have so much cool stuff..."

extra {"artichoke-covered shrine", "shrine", "artichokes", "south wall"}
"&lThis shrine is really spiffy.  The shrine itself is made of wood, but
it is completely covered by artichokes.  Baby artichokes, ripe artichokes,
imitation artichokes, and hundreds of other kinds are strewn everywhere.
Looking at this structure, you think to yourself, 'Geez, someone really
likes their vegetables...'"

extra {"autographed posters", "posters", "kyt poster", "zex poster"}
"&lOn either side of the artichoke shrine are life-sized, stand-up posters
of Kyt and Zex.  They are signed 'To Kira, whom we love more than life
itself, Kyt and Zex'"

extra {"framed letter", "letter"}
"&lThe letter is from Dax, and it reads:

     'Kira you bitch, why aren't I in your room?
                    --Dax'"

extra {"eastern wall", "icculus picture", "signed picture", "picture"}
"The picture is of the big guy himself.  Pretty darn cool."

extra {"snapshot", "spankii picture", "lizard"}
"&lThe snapshot is of a gleeful Spankii as he happily turns a lizard into
a piping-hot plate of mashed potatoes.  Where does Kira get all of this
great stuff?"

extra {"shelf", "western wall", "action figure", "figure", "sky the god"}
"&lYes, you can hardly believe your eyes, but it is an actual Sky the
God action figure resting on the shelf.  Gosh, Kira is sure lucky to
have one of those..."

flags {UNIT_FL_NO_WEATHER, UNIT_FL_INDOORS}
movement SECT_INSIDE
down to floor_1m descr "I guess Kira put in a way for you to get out...";
ALWAYS_LIGHT
end    /* kira_room */

%mobiles

/*    ******    Inventory for mobiles    ******    */
/*       eiyonel     150   (1 max...required for quest)
         aristol     150   (1 max...required for quest)
         drynmyr     150   (1 max...required for quest)
         sarinyil    150   (1 max...required for quest)
         lorimar     150   (1 max...used in quest)
         eth. warr.  150   (1 max...used in quest)
         mys. knight 150   (1 max...used in quest)
         kerril      12    (1 max)
         wand. orc   9     (2 max...1 per reset)
         boggo       8     (1 max...teamwork w/baggo)
         baggo       8     (1 max...teamwork w/boggo)
         tower gob.  10    (1 max)
         kvork       10    (1 max...teamwork w/tgark)
         tgark       10    (1 max...teamwork w/kvork)
         inex.thief  9     (1 max...carries an item for a quest)
         lassiter    11    (1 max)
         orc sold.   11    (1 max)
         reneg. orc  13    (1 max)
         str. guard. 12    (3 max...2 per reset)
*/

                        eiyonel
names {"eiyonel", "elf", "healer"}
title "Eiyonel"
descr "Eiyonel, humble elven healer, is quietly humming his meditations."
extra {}
"&lThis ancient elf wears an expression of kindness and benevolence on his
face, and you feel immediately welcome in his presence.  Everything about
this elf is simple, yet he seems to posess a power much greater than what
is outwardly shown.  Maybe it would be worth your while to stop and find
out if this creature would be willing to give you a little help..."
M_ELF_CLERIC_HAMMER (150, SEX_MALE, "cast acid ball", "cast heal")
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,5,5,6,4,5,5,5,4,6,9)
MSET_WEAPON (9,5,6,4,9,4)
alignment 500
money 3 SILVER_PIECE
exp -50  /* I don't want him killed */
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil for Eiyonel's quest  */
dilbegin eiyonnel1();
var
  item   : unitptr;
  pc     : unitptr;
  i      : integer;
  expd   : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*4;
    on_activation((self.position <= POSITION_SLEEPING) or
      (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (not command(CMD_GIVE)));
    if ((EIYONEL_COMPLETE in activator.quests) or (KITHYRN_COMPLETE in
         activator.quests))
      goto waitawhile;
    pc := activator;
    secure(pc,lostpc);
    if (not (EIYONEL_ONGOING in pc.quests)) {
      pause;
      exec("say Hello, "+pc.name +".", self); pause;
      exec("say I do not suppose it has been easy for you to find "+
           "me...", self);
      exec("emote chuckles to himself.", self); pause;
      exec("say But now that you have come, I wonder what it is you "+
           "might want?", self); pause;
      exec("say Hmmm... I have some information which might be of use "+
           "to you, but there is something I would like you to do for "+
           "me first.", self); pause;
      exec("grin"+pc.name, self); pause;
      exec("say These are hard times, and not everyone can be "+
           "trusted.", self); pause;
      exec("say To prove to me that you are of a good heart, could you "+
           "first do me a small favor?", self); pause;
      exec("say It is only a tiny thing -- please nod if you are "+
           "willing.", self);
      i := 0;
      while (i < 3) {
        wait(SFB_CMD, activator #= pc);
        if (command(CMD_NOD))
          goto quest_accept;
        if (command(CMD_SAY)) {
          pause;
          exec("say Please nod if you accept, or shake if you "+
               "refuse.", self);
        }
        if (command(CMD_SHAKE))
          goto quest_refuse;
        i := i+1;
      }
      :quest_refuse:
        pause;
        exec("sigh", self); pause;
        exec("say OK, it is your decision to make.  Return if ever "+
             "again you wish my assistance!", self); pause;
        exec("wave "+pc.name, self);
        unsecure(pc);
        goto waitawhile;
      :quest_accept:
        pause;
        exec("say Wonderful!  All that I require are some berries!",
             self); pause;
        addextra(pc.quests, {EIYONEL_ONGOING}, "");
        exec("say A spell I have been working on, is, ah, not quite "+
             "right...", self); pause;
        exec("emote grins at you.", self); pause;
        exec("say If only I had some juniper berries, I'm sure that I "+
             "could get it to work!", self); pause;
        exec("say I think that there used to be several juniper bushes "+
             "growing just outside of the tower...", self); pause;
        exec("say If you look around out there, I'm sure you'll find "+
             "plenty!  And when you do, be sure to bring them back "+
             "to me!", self);
        unsecure(pc);
        goto start;
    }
    else {
      expd := EIYONEL_ONGOING in pc.quests;
      if ("juniper berries" in expd.names) {
        pause;
        subextra(pc.quests, EIYONEL_ONGOING);
        addextra(pc.quests, {EIYONEL_COMPLETE}, "");
        exec("say The fourth floor of this tower is a rather unusual "+
             "place.", self); pause;
        exec("emote grins at you in a peculiar manner.", self); pause;
        exec("say We have to guard things pretty well nowadays...",
             self); pause;
        exec("emote takes out a quill and paper and quickly writes a "+
             "brief message.", self); pause;
        exec("say If you should go up there, give this note to the elf "+
             "named Lorimar.  When he sees this, I'm sure he'll let you "+
             "pass.  Without it, he may not be so kind...", self); pause;
        item := load ("eiyonel_note@tower");
        link(item,pc);
        act("Eiyonel gives $1n the note.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("Eiyonel gives you the note.", A_ALWAYS, pc,
             null, null, TO_CHAR);
        pause;
        exec("say Thank you again for your help, "+pc.name +".",
             self); pause;
        exec("say Goodbye!  And good luck!", self);
      }
    }
    unsecure(pc);
    goto start;
    :waitawhile:
      heartbeat := PULSE_SEC*20;
      pause;
      goto init;
    :lostpc:
      exec("say They left, huh?  Oh well...", self); pause;
      exec("sigh", self);
      goto start;
}
dilend

dilbegin eiyonnel2();
var
  pc   : unitptr;
  item : unitptr;
  expd : extraptr;
code {
  heartbeat := PULSE_SEC*4;
  on_activation((self.position <= POSITION_SLEEPING) or
    (self.position == POSITION_FIGHTING), skip);
  :start:
    nopriority;
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (command(CMD_GIVE)));
    priority;
  :give:
    if (not(EIYONEL_ONGOING in activator.quests))
      goto start;
    pc := activator;
    item := self.inside;
    secure(pc, labsecure);
    secure(item, labsecure);
    wait (SFB_CMD | SFB_TICK, TRUE);
    if (not (item #= self.inside)) {
      unsecure(item);
      expd := EIYONEL_ONGOING in pc.quests;
      if ("juniper berries" in self.inside.name) {
        addstring(expd.names, "juniper berries");
        exec("say Excellent!  Just what I needed... and now, as I "+
             "promised...", self);
        destroy(self.inside);
      }
      else {
        exec("say Hmmm... I don't think that these are juniper "+
             "berries...", self);
        link(self.inside, pc);
        exec("emote returns what has been given to him.", self);
      }
    }
    unsecure(pc);
    if ((command(CMD_GIVE)) and (activator.type == UNIT_ST_PC)) {
      goto give;
    }
    else
      goto start;
  :labsecure:
    exec("say They left, huh?  Oh well...", self); pause;
    exec("sigh", self);
    goto start;
}
dilend
end    /* eiyonel */

                        aristol
names {"aristol", "elf", "fighter"}
title "Aristol"
descr "Aristol, ancient elven fighter, is here."
extra {}
"&lAristol is obviously a very ancient elf, yet he has kept himself in
excellent physical condition.  His silvery hair falls down over his
shoulders, yet it can not completely hide the scar on his forehead.  His
clothes are simple, but the sword which he wears at his side is quite
ornate, and also of amazing craftsmanship.  You have few doubts that,
despite his age, Aristol would still be very capable of defending himself."
M_ELF_WARRIOR_AXE (150, SEX_MALE)
MSET_ABILITY (15,15,15,15,13,13,14,0)
MSET_SPELL (5,4,5,5,5,5,5,5,5,5,5)
MSET_WEAPON (9,7,7,7,9,7)
alignment 500
money 3 SILVER_PIECE
exp -50  /* I don't want him killed */
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil for Aristol's quest  */
dilbegin aristol1();
var
  pcname : string;
  item   : unitptr;
  pc     : unitptr;
  i      : integer;
  expd   : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*4;
    on_activation((self.position <= POSITION_SLEEPING) or
      (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (not command(CMD_GIVE)));
    if ((ARISTOL_COMPLETE in activator.quests) or (KITHYRN_COMPLETE in
         activator.quests))
      goto waitawhile;
    pc := activator;
    secure(pc,lostpc);
    if (not (ARISTOL_ONGOING in pc.quests)) {
      pause;
      exec("say Ah, "+pc.name +".  I was wondering if someone might be "+
           "coming along.", self); pause;
      exec("say And what is it that you have come to seek of old "+
           "Aristol?", self); pause;
      exec("say I have spent my life learning the ways of the great "+
           "warriors of this land... perhaps I can share with you "+
           "some of what I have learned.", self); pause;
      exec("smile", self); pause;
      exec("say But before I share with you what I know, I would like "+
           "you to do me a small favor.", self); pause;
      exec("say Long ago, I would everyday go to a small room in this "+
           "tower for meditation and my daily exercise.", self); pause;
      exec("say In this room I kept a book, which contained a "+
           "record of the great battles fought by the elves of "+
           "this tower.", self); pause;
      exec("say If you can find this room, would you please bring me the "+
           "book that you will find locked up within?", self); pause;
      exec("say Please nod if you are willing to undertake this "+
           "search.", self);
      i := 0;
      while (i < 3) {
        wait(SFB_CMD, activator #= pc);
        if (command(CMD_NOD))
          goto quest_accept;
        if (command(CMD_SAY)) {
          pause;
          exec("say Please nod if you accept, or shake if you "+
               "refuse.", self);
        }
        if (command(CMD_SHAKE))
          goto quest_refuse;
        i := i+1;
      }
      :quest_refuse:
        pause;
        exec("say All right, go about your way.  I will be here if you "+
             "choose to return.", self); pause;
        exec("wave "+pc.name, self);
        unsecure(pc);
        goto waitawhile;
      :quest_accept:
        pause;
        exec("say Good, I thought you were one of good judgment.",
             self); pause;
        addextra(pc.quests, {ARISTOL_ONGOING}, "");
        exec("emote smiles.", self); pause;
        exec("say Be thorough in your searches!  And return when you "+
             "have the book!", self); pause;
        exec("wave "+pc.name, self);
        unsecure(pc);
        goto start;
    }
    else {
      expd := ARISTOL_ONGOING in pc.quests;
      if ("aristol's book" in expd.names) {
        pause;
        subextra(pc.quests, ARISTOL_ONGOING);
        addextra(pc.quests, {ARISTOL_COMPLETE}, "");
        exec("emote holds the book in his hands lovingly.", self); pause;
        exec("say Thank you, "+pc.name +", I am very grateful to "+
             "you.", self); pause;
        exec("say And as I promised...", self); pause;
        exec("emote takes a beautiful dagger from his desk.", self); pause;
        exec("say On the fourth floor of this tower is an ethereal warrior "+
             "who helps to guard the tower treasures from any who "+
             "might wish to steal them.", self); pause;
        exec("say Only this dagger will allow you to defeat him and gain "+
             "entrance into the rooms which he guards.", self); pause;
        item := load ("aristol_dagger@tower");
        item.height := pc.height;
        link(item,pc);
        act("Aristol gives $1n the dagger.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("Aristol gives you the dagger.", A_ALWAYS, pc,
             null, null, TO_CHAR);
        pause;
        exec("say Go now, "+pc.name +", and good luck.", self); pause;
        exec("wave "+pc.name, self);
      }
    }
    unsecure(pc);
    goto start;
    :waitawhile:
      heartbeat := PULSE_SEC*20;
      pause;
      goto init;
    :lostpc:
      exec("say Strange that they should leave... perhaps I judged them "+
           "wrong.", self); pause;
      exec("sigh", self);
      goto start;
}
dilend

dilbegin aristol2();
var
  pc   : unitptr;
  item : unitptr;
  expd : extraptr;
code {
  heartbeat := PULSE_SEC*4;
  on_activation((self.position <= POSITION_SLEEPING) or
    (self.position == POSITION_FIGHTING), skip);
  :start:
    nopriority;
    wait(SFB_CMD,(command(CMD_GIVE)) and (activator.type == UNIT_ST_PC));
    priority;
  :give:
    if (not(ARISTOL_ONGOING in activator.quests))
      goto start;
    pc := activator;
    item := self.inside;
    secure(pc, labsecure);
    secure(item, labsecure);
    wait (SFB_CMD | SFB_TICK, TRUE);
    if (not (item #= self.inside)) {
      unsecure(item);
      expd := ARISTOL_ONGOING in pc.quests;
      if ("aristol's book" in self.inside.name) {
        addstring(expd.names, "aristol's book");
        exec("say Ah, it has been long since I have leafed through these "+
             "pages.", self);
        destroy(self.inside);
      }
      else {
        exec("say I'm afraid that this is not my book "+pc.name +".", self);
        link(self.inside, pc);
        exec("emote returns what has been given to him.", self);
      }
    }
    unsecure(pc);
    if ((command(CMD_GIVE)) and (activator.type == UNIT_ST_PC)) {
      goto give;
    }
    else
      goto start;
    :labsecure:
      exec("say Strange that they should leave... perhaps I judged them "+
           "wrong.", self); pause;
      exec("sigh", self);
      goto start;
}
dilend
end    /* aristol */

                        drynmyr
names {"drynmyr", "elf", "librarian"}
title "Drynmyr"
descr "Drynmyr, the elven librarian, stands here."
extra {}
"&lDrynmyr bears himself in a stately manner despite his advanced age.  The
tower librarian looks to be an incredibly intelligent man, and you can only
guess at the amount of knowledge which he may have acquired during his long
lifetime.  As you look at him he begins a quiet incantation-- apparently
he has included the arts of magic among the many subjects which he has
studied."
M_ELF_CLERIC_HAMMER (150, SEX_MALE, "cast acid ball", "cast heal")
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,4,4,5,4,6,6,4,4,6,9)
MSET_WEAPON (9,6,5,5,9,5)
alignment 500
money 3 SILVER_PIECE
exp -50  /* I don't want him killed */
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil for Drynmyr's quest  */
dilbegin drynmyr1();
var
  pcname : string;
  item1  : unitptr;
  item2  : unitptr;
  pc     : unitptr;
  i      : integer;
  expd   : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*4;
    on_activation((self.position <= POSITION_SLEEPING) or
      (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (not command(CMD_GIVE)));
    if ((DRYNMYR_COMPLETE in activator.quests) or (KITHYRN_COMPLETE in
         activator.quests))
      goto waitawhile;
    pc := activator;
    secure(pc,lostpc);
    if (not (DRYNMYR_ONGOING in pc.quests)) {
      pause;
      exec("emote looks up from the book he has been reading.",
           self); pause;
      exec("say Hello, "+pc.name +".  Welcome to Kithyrn.", self); pause;
      exec("say I don't imagine that you have traveled all the way here "+
           "for no reason... you must be seeking something.", self);
           pause;
      exec("emote grins in a knowing manner.", self); pause;
      exec("say Perhaps I can be of help to you.  I have some "+
           "information which I believe will prove very valuable to "+
           "you, but there is something I would like you to do for me "+
           "in return.", self); pause;
      exec("smile", self); pause;
      exec("say Underneath this tower is stored an object of hidden "+
           "power known as the elven star.", self); pause;
      exec("say This treasure is guarded by elven magic -- only those "+
           "who are truly worthy may seek it, and only those of purest "+
           "heart will have any chance of finding it.", self); pause;
      exec("say To prove that you are deserving of the help of the "+
           "tower elves, you must bring a shard from the elven star "+
           "to me.", self); pause;
      exec("say If you are willing to undertake this quest, please nod "+
           "your head.", self); pause;
      i := 0;
      while (i < 3) {
        wait(SFB_CMD, activator #= pc);
        if (command(CMD_NOD))
          goto quest_accept;
        if (command(CMD_SAY)) {
          pause;
          exec("say Please nod if you accept, or shake if you "+
               "refuse.", self);
        }
        if (command(CMD_SHAKE))
          goto quest_refuse;
        i := i+1;
      }
      :quest_refuse:
        pause;
        exec("say Go about your way then.  I shall remain here if you "+
             "choose to return.", self); pause;
        exec("bow "+pc.name, self);
        unsecure(pc);
        goto waitawhile;
      :quest_accept:
        pause;
        exec("say Very good.  Before you embark, you will need a key to "+
             "the basement.", self); pause;
        exec("emote reaches into his cloak and takes out a tiny key.",
             self); pause;
        item1 := load ("basement_key@tower");
        link(item1,pc);
        act("Drynmyr gives $1n the key.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("Drynmyr gives you the key.", A_ALWAYS, pc,
             null, null, TO_CHAR);
        pause;
        exec("say Goodbye now, "+pc.name +", return when you have found "+
             "the elven star.", self);
        addextra(pc.quests, {DRYNMYR_ONGOING}, "");
        unsecure(pc);
        goto start;
    }
    else {
      expd := DRYNMYR_ONGOING in pc.quests;
      if ("elven star shard" in expd.names) {
        pause;
        subextra(pc.quests, DRYNMYR_ONGOING);
        addextra(pc.quests, {DRYNMYR_COMPLETE}, "");
        exec("emote holds the shard high over his head and begins "+
             "a strange incantation.", self); pause;
        act("$1n is enveloped in an unusual blue light.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("You are enveloped in an unusual blue light.", A_ALWAYS,
             pc, null, null, TO_CHAR);
        pause;
        act("The light surrounding $1n slowly fades.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("The light surrounding you slowly fades.", A_ALWAYS,
             pc, null, null, TO_CHAR);
        pause;
        exec("say This shard of the elven star has given you the "+
             "ability to defeat the third guardian of this tower.",
             self); pause;
        exec("say Many of the treasures of this tower are kept on the "+
             "fourth floor.  They are watched by three guardians.",
             self); pause;
        exec("say The first guardian is the brave elf Lorimar, but "+
             "the second two are creatures not of this world.",
             self); pause;
        exec("say If you should reach the second of these guardians, "+
             "you need only say the words 'allinom baril' and "+
             "you will be able to pass.", self); pause;
        exec("say Do not forget these words!  Only they will allow you "+
             "access to what is held within Kithyrn.", self); pause;
        item2 := load ("drynmyr_note@tower");
        link(item2,pc);
        act("Drynmyr gives $1n a note.", A_SOMEONE,
             pc, null, null, TO_REST);
        act("Drynmyr gives you a note.", A_ALWAYS, pc,
             null, null, TO_CHAR);
        pause;
        exec("say If you should forget what I have told you, refer back "+
             "to this note.", self); pause;
        exec(" say Goodbye now, "+pc.name +", I wish you success in your "+
             "journeys.", self); pause;
        exec("bow "+pc.name, self);
      }
    }
    unsecure(pc);
    goto start;
    :waitawhile:
      heartbeat := PULSE_SEC*20;
      pause;
      goto init;
    :lostpc:
      exec("say They left?  I suppose that they shall be back soon",
           self); pause;
      exec("sigh", self);
      goto start;
}
dilend

dilbegin drynmyr2();
var
  pc   : unitptr;
  item : unitptr;
  expd : extraptr;
code {
  heartbeat := PULSE_SEC*4;
  on_activation((self.position <= POSITION_SLEEPING) or
    (self.position == POSITION_FIGHTING), skip);
  :start:
    nopriority;
    wait(SFB_CMD,(command(CMD_GIVE)) and (activator.type == UNIT_ST_PC));
    priority;
  :give:
    if (not(DRYNMYR_ONGOING in activator.quests))
      goto start;
    pc := activator;
    item := self.inside;
    secure(pc, labsecure);
    secure(item, labsecure);
    wait (SFB_CMD | SFB_TICK, TRUE);
    if (not (item #= self.inside)) {
      unsecure(item);
      expd := DRYNMYR_ONGOING in pc.quests;
      if ("elven star shard" in self.inside.name) {
        addstring(expd.names, "elven star shard");
        exec("say Well, "+pc.name +", it seems that you are indeed "+
             "worthy to receive the help of the tower elves.", self);
        destroy(self.inside);
      }
      else {
        exec("say This is not a shard of the elven star, "+pc.name +".",
             self);
        link(self.inside, pc);
        exec("emote returns what has been given to him.", self);
      }
    }
    unsecure(pc);
    if ((command(CMD_GIVE)) and (activator.type == UNIT_ST_PC)) {
      goto give;
    }
    else
      goto start;
    :labsecure:
      exec("say They left?  I suppose that they shall be back soon.",
           self); pause;
      exec("sigh", self);
      goto start;
}
dilend
end    /* drynmyr */

                        sarinyil
names {"sarinyil", "elf", "keeper"}
title "Sarinyil"
descr "Sarinyil, the keeper of the tower treasures, stands before you."
extra {}
"&lThis elf, while very old, nevertheless radiates a feeling of benevolence
and intelligence.  Her clothes are simple, and her manner easy, so that
you at once feel at ease in her presence.  As the keeper of this tower
you assume that she must be a well-respected and much loved member of the
elven clan.  Any ill thoughts you may have had towards this kindly old
elf disappear as she turns to you with a welcoming smile."
M_ELF_CLERIC_HAMMER (150, SEX_FEMALE, "cast acid ball", "cast heal")
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,4,4,5,4,6,6,4,4,6,9)
MSET_WEAPON (9,6,5,5,9,5)
alignment 500
money 3 SILVER_PIECE
exp -50  /* I don't want her killed */
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil for tower quest reward  */
dilbegin sarinyil1();
var
  item   : unitptr;
  pc     : unitptr;
  i      : integer;
  expd   : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*5;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC));
    if (KITHYRN_COMPLETE in activator.quests)
      goto waitawhile;
    pc := activator;
    secure(pc,lostpc);
    if ((not(EIYONEL_COMPLETE in pc.quests)) or (not(ARISTOL_COMPLETE
         in pc.quests)) or (not(DRYNMYR_COMPLETE in pc.quests))) {
      exec("say How did you get here, "+pc.name +"?", self); pause;
      exec("say You have not yet completed the tasks of the tower "+
           "elves.  You should not be here...", self); pause;
      exec("say Please do not return until you have completed the tasks "+
           "which the other elves set you to.", self); pause;
      unsecure(pc);
      goto waitawhile;
    }
    exec("say Hello, "+pc.name +".  I have been waiting for you.",
         self); pause;
    exec("say You have done all that has been asked of you, and by "+
         "passing the tests of this tower you have proven yourself "+
         "to be worthy of our help.", self); pause;
    exec("say The treasures of this tower are numerous, as you can "+
         "see.", self);
    exec("emote waves her hand, pointing to the contents of the room "+
         "with the gesture.", self); pause;
    exec("say To help you in your future journeys, please choose one of "+
         "our treasures to take with you.", self); pause;
    exec("say You have three objects to choose from.  Please listen "+
         "carefully to what I have to say, and then make your choice.",
         self); pause;
    exec("say The first of these treasures are sleeves which were worn by "+
         "ancient elven knights, and added to both their strength and "+
         "dexterity.", self); pause;
    exec("say The second treasure which you may choose is a pendant "+
         "which aided elven magicians by adding to their brain and "+
         "charisma, allowing them to create powerful magic.", self);
         pause;
    exec("say The final object which we offer to you are leggings which "+
         "long ago gave elven travelers added strength and constitution,"+
         " and also the ability to see objects which were invisible "+
         "without the leggings.", self); pause;
    exec("say Please choose from among these treasures.  If your choice "+
         "is the sleeves, merely say 'sleeves'.  Should you choose "+
         "the pendant, say 'pendant', and for the leggings, say "+
         "'leggings'.", self);
    exec("say If you would like to wait until later to make "+
         "your decision, please say 'none', and then return when you "+
         "are ready.", self);
    i := 0;
  :wait_say:
    if (i < 3) {
      wait(SFB_CMD,(command(CMD_SAY)) and (activator #= pc));
    }
    else {
      goto no_item;
    }
  :item_choose:
    if ("sleeves" in argument) {
      exec("emote takes a beautiful pair of sleeves from a shelf.", self);
           pause;
      exec("say These sleeves served many an elven knight.  They will "+
           "now serve you as well, "+pc.name +".", self); pause;
      act("Sarinyil gives $1n the sleeves.", A_SOMEONE,
           pc, null, null, TO_REST);
      act("Sarinyil gives you the sleeves.", A_ALWAYS, pc,
           null, null, TO_CHAR);
      item := load("kith_sleeves@tower");
      item.height := pc.height;
      link(item, pc);
      addextra(pc.quests, {KITHYRN_COMPLETE}, "");
      subextra(pc.quests, EIYONEL_COMPLETE);
      subextra(pc.quests, ARISTOL_COMPLETE);
      subextra(pc.quests, DRYNMYR_COMPLETE);
      goto goodbye;
    }
    if ("pendant" in argument) {
      pause;
      exec("emote takes a small pendant from a shelf.", self); pause;
      exec("say This pendant helped our ancestors to create powerful "+
           "magic.  We have waited long for one who would be worthy "+
           "of reviving its powers.", self); pause;
      act("Sarinyil gives $1n the pendant.", A_SOMEONE,
           pc, null, null, TO_REST);
      act("Sarinyil gives you the pendant.", A_ALWAYS, pc,
           null, null, TO_CHAR);
      item := load("kith_pendant@tower");
      item.height := pc.height;
      link(item, pc);
      addextra(pc.quests, {KITHYRN_COMPLETE}, "");
      subextra(pc.quests, EIYONEL_COMPLETE);
      subextra(pc.quests, ARISTOL_COMPLETE);
      subextra(pc.quests, DRYNMYR_COMPLETE);
      goto goodbye;
    }
    if ("leggings" in argument) {
      pause;
      exec("emote takes an old pair of leggings from a shelf.", self);
           pause;
      exec("say With these leggings, travelers from Kithyrn were once "+
           "able to travel to the farthest realms of this land.  Now "+
           "the magic contained within them shall serve you.", self);
           pause;
      act("Sarinyil gives $1n the leggings.", A_SOMEONE,
           pc, null, null, TO_REST);
      act("Sarinyil gives you the leggings.", A_ALWAYS, pc,
           null, null, TO_CHAR);
      item := load("kith_leggings@tower");
      item.height := pc.height;
      link(item, pc);
      addextra(pc.quests, {KITHYRN_COMPLETE}, "");
      subextra(pc.quests, EIYONEL_COMPLETE);
      subextra(pc.quests, ARISTOL_COMPLETE);
      subextra(pc.quests, DRYNMYR_COMPLETE);
      goto goodbye;
    }
  :no_item:
    if ("none" in argument) {
      pause;
      exec("say You may return at any time, "+pc.name +".", self); pause;
      exec("bow "+pc.name, self);
      unsecure(pc);
      goto waitawhile;
    }
    else {
      exec("say Please choose from among these treasures.  If your choice "+
           "is the sleeves, merely say 'sleeves'.  Should you choose "+
           "the pendant, say 'pendant', and for the leggings, say "+
           "'leggings'.", self);
      exec("say If you would like to wait until later to make "+
           "your decision, please say 'none', and then return when you "+
           "are ready.", self);
      i := i+1;
      goto wait_say;
    }
  :goodbye:
    act("You receive 1500 experience for completion of the quests of "+
         "the tower elves.", A_ALWAYS, pc, null, null, TO_CHAR);
    experience(1500, pc); pause;
    exec("say By passing the tests set to you by the other elves you "+
         "have proven yourself worthy of the reward which you "+
         "received.  Go now, and let yourself be an example for "+
         "others to follow.", self); pause;
    exec("bow "+pc.name, self);
    unsecure(pc);
    goto start;
  :lostpc:
    exec("say They shall return.", self); pause;
    exec("smile", self); pause;
    goto start;
  :waitawhile:
    heartbeat := PULSE_SEC*20;
    pause;
    goto init;
}
dilend
end    /* sarinyil */

                        lorimar
names {"elven knight", "lorimar", "knight", "elf"}
title "Lorimar the elven knight"
descr "Lorimar, brave elven knight, stands here awaiting your challenge."
extra {}
"&lLorimar is one of the last of the remaining elven knights who did battle
in ancient times with the dragon Ancalador.  Despite his advanced age he
is still in excellent physical condition, and you are certain that trying
to fight your way past him would be a grave mistake."
M_ELF_CLERIC_HAMMER (150, SEX_MALE, "cast lightning bolt", "cast heal")
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,4,4,5,4,6,6,4,4,6,9)
MSET_WEAPON (9,6,5,5,9,5)
alignment 500
money 1 SILVER_PIECE
exp -50  /* I don't want him killed */
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil to accept note and allow passage */
dilbegin lorimar1();
var
  pc   : unitptr;
  item : unitptr;
  expd : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    nopriority;
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (command(CMD_GIVE)));
    priority;
  :give:
    pc := activator;
    if (not(EIYONEL_COMPLETE in pc.quests)) {
      goto start;
    }
    item := self.inside;
    secure(pc,labsecure);
    secure(item,labsecure);
    wait(SFB_CMD | SFB_TICK, TRUE);
    expd := EIYONEL_COMPLETE in pc.quests;
    if (not (item #= self.inside)) {
      unsecure(item);
      if ("eiyonel's note" in self.inside.name) {
        addstring(expd.names, "eiyonel's note");
        exec("emote quickly glances over the note.", self);
        destroy(self.inside);
        exec("say If Eiyonel deems you worthy to pass, so do I.", self);
        exec("smile"+ pc.name, self);
      }
      else {
        link(self.inside, pc);
        exec("emote returns the item.", self);
        exec("say I have no use for that, "+pc.name +".", self);
        goto start;
      }
    }
    unsecure(pc);
    if ((command(CMD_GIVE)) and (activator.type == UNIT_ST_PC)) {
      goto give;
    }
    else
      goto start;
  :labsecure:
    pause;
    goto start;
}
dilend

/*  Dil to cause Lorimar to block or allow passage when appropriate */
dilbegin lorimar2();
var
  pc     : unitptr;
  expd   : extraptr;
code {
  :start:
    heartbeat := PULSE_SEC*3;
    nopriority;
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (command(CMD_WEST)));
    priority;
    pc := activator;
    if ((EIYONEL_COMPLETE in pc.quests)) {
      expd := EIYONEL_COMPLETE in pc.quests;
      if (not("eiyonel's note" in expd.names)) {
        block;
        exec("say I'm afraid I can't allow you to go there, "+pc.name +"."+
           "  Visit Eiyonel and then return.", self);
        unsecure(pc);
        goto start;
      }
      else {
        pause;
      }
    }
    if ((KITHYRN_COMPLETE in pc.quests)) {
      pause;
    }
}
dilend
special SFUN_GUARD_WAY "3floor_4l@@$1n stops you from continuing."+
     "@$1n prevents $3n from continuing west."
end    /* lorimar */

                        eth_warrior
names {"ethereal warrior", "warrior"}
title "an ethereal warrior"
descr "An ethereal warrior is guarding the area."
extra {}
"&lThis creature is one of the most unique you have ever seen.  It looks
almost like a ghost, and yet you are certain that it is not.  This creature
is one who perhaps inhabits both the spirit plane and your own plane of
existence at the same time.  Its shape is difficult to define, and its
color also seems to be shifting.  The only thing which you can be certain
of is that it is probably better to leave this being alone."
level 150
alignment 250
race RACE_SPIRIT
sex SEX_NEUTRAL
weight 100
height 150
exp -50  /* I don't want it killed */
NATURAL_DEF(WPN_FIST, ARM_PLATE)
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,4,4,5,4,6,6,4,4,6,9)
MSET_WEAPON (9,6,5,5,9,5)
special SFUN_COMBAT_MAGIC "cast lightning bolt"
special SFUN_GUARD_WAY "3floor_4k@@$1n stops you from continuing."+
     "@$1n prevents $3n from continuing west."
end    /* eth_warrior */

                        mys_knight
names {"mystic knight", "knight"}
title "a mystic knight"
descr "A mystic knight watches the area."
extra {}
"&lLike the ethereal warrior in the room before, this creature looks almost
like a ghost, and yet you are certain that it is not.  You suspect that it
is one who inhabits both the spirit plane and your own plane of existence
at the same time.  Its shape is difficult to define, and its color also
seems to be shifting.  The only thing which you can be certain of is that
it is probably better to leave this being alone."
level 150
alignment 250
race RACE_SPIRIT
sex SEX_NEUTRAL
weight 100
height 150
exp -50  /* I don't want it killed */
NATURAL_DEF(WPN_FIST, ARM_PLATE)
MSET_ABILITY (15,15,8,12,15,5,15,15)
MSET_SPELL (9,4,4,5,4,6,6,4,4,6,9)
MSET_WEAPON (9,6,5,5,9,5)
special SFUN_COMBAT_MAGIC_HEAL "cast heal"
special SFUN_COMBAT_MAGIC "cast lightning bolt"
special SFUN_GUARD_WAY "0floor_4j@@$1n stops you from continuing."+
     "@$1n prevents $3n from continuing north."

/*  Dil to transport player if they have done the quest and speak the
    correct words.  Dil modified from that in link room, created by A.
    Cowan (Icculus) */

dilbegin knight1();
var
  pc   : unitptr;
  item : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*2;
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC) and (command(CMD_SAY)));
    if (not(DRYNMYR_COMPLETE in activator.quests) and not(KITHYRN_COMPLETE
         in activator.quests))
      goto start;
    pc := activator;
    secure(pc,lostpc);
    if (not("allinom baril" in argument)) {
      unsecure(pc);
      goto start;
    }
    else {
      block;
      act("You speak words of powerful magic.", A_ALWAYS, pc, null,
           null, TO_CHAR);
      act("$1n speaks words of powerful magic.", A_SOMEONE, pc, null,
           null, TO_REST);
      pause;
      act("The mystic knight suddenly bursts into a myriad of blue "+
           "sparks which surround you in a blinding light.", A_ALWAYS,
           pc, null, null, TO_CHAR);
      act("The mystic knight suddenly bursts into a myriad of blue "+
           "sparks which surround $1n in a blinding light.",
           A_SOMEONE, pc, null, null, TO_REST);
      pause;
      act("As the light subsides, you notice that you have been "+
           "transported to a new room.", A_ALWAYS, pc, null,
           null, TO_CHAR);
      act("The blue light subsides, and you see that $1n is "+
           "no longer in the room with you.", A_HIDEINV, pc,
           null, null, TO_REST);
      pause;
      link(pc, findroom("tower/floor_4f"));
      exec("look", pc);
      act(pc.name+" has arrived.", A_HIDEINV, self.inside,
           null, null, TO_REST);
      unsecure(pc);
    }
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* mys_warrior */

                        kerril
names {"elven steward", "kerril", "steward", "elf"}
title "Kerril the elven steward"
descr "Kerril the elven steward stands here."
extra {}
"&lThe steward is an old elf who has kept himself well, but who is
nevertheless looking very tired and worn out.  His duties as tower steward
have taken their toll, and although he is still busily working to make sure
that the storeroom is kept in order, you sense that his remaining days in
this world are quickly winding down..."
M_ELF_CLERIC_HAMMER (12, SEX_MALE, "cast lightning bolt", "cast heal")
MSET_ABILITY (17,18,6,10,15,7,7,20)
MSET_SPELL (18,0,4,4,4,4,4,4,18,4,5)
MSET_WEAPON (15,3,2,3,5,3)
alignment 500
money 6 COPPER_PIECE
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil to bring Kerril to life */

dilbegin kerril1();
code {
  :init:
    heartbeat := PULSE_SEC*10;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC));
    exec("emote notices you and jumps slightly.", self); pause;
    exec("say Hello!  You startled me a bit... you see, it's not often "+
         "that visitors come here.", self); pause;
    exec("say There aren't many visitors to the tower any more...", self);
         pause;
    exec("say Umm, I see that you are well-armed... I am just a simple "+
         "steward... I bear you no ill will.", self); pause;
    exec("say Perhaps I can even be of assistance to you!  This portion of "+
         "the tower is home to some of our finest treasures!  But they "+
         "are well guarded...", self); pause;
    exec("say If you have not yet visited the other tower elves, I "+
         "suggest that you do so before continuing on...", self); pause;
    exec("say Our guardians are fierce, and would surely kill you if "+
         "you tried to force your way past them...", self); pause;
    exec("say I would hope that this advice will help you... and now, "+
         "perhaps I can offer you some, eh, refreshment?", self);
    exec("emote points at the wine barrel.", self); pause;
    exec("say Let us drink to friendship!", self); pause;
    exec("emote smiles nervously at you and then takes a long drink from "+
         "the wine barrel.", self); pause;
    pause; pause; pause; pause; pause; pause;
    goto init;
}
dilend
end    /* kerril */

                        wandering_orc
names {"wandering orc", "orc"}
title "a wandering orc"
descr "An orc is here, wandering throughout the area."
extra {}
"&lThis creature is one who seems never to be content where it is, and is
therefore always wandering around looking for some new mischief to perform.
It is obvious that bathing is not a favorite activity of this orc, and
you wonder that you were not able to smell the creature before you saw it."
M_AVG_ORC (9, SEX_MALE)
alignment -100
money 2 COPPER_PIECE
special SFUN_RANDOM_ZONE_MOVE time 300 bits SFB_RANTIME

/*  Dil to bring wandering orc to life */

dilbegin wandering_orc1();
code {
  :init:
    heartbeat := PULSE_SEC*20;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("emote grunts.", self); pause;
    exec("say Me hungry.  Want food!", self); pause;
    exec("emote reaches into his sack and pulls out a filthy piece of "+
         "meat.", self); pause;
    exec("emote begins eating hungrily.", self);
    exec("emote burps.", self); pause;
    exec("emote sighs happily.", self); pause;
    exec("say That yummy.  But me still hungry... what me eat now?", self);
         pause;
    exec("emote scratches his head.", self); pause;
    exec("say Bunny!  Maybe there nice bunny in tower!  Me go find one "+
         "to eat!", self); pause;
    exec("emote looks very happy with himself.", self); pause;
    exec("emote suddenly frowns.", self); pause;
    exec("say Wait, bunnies live in field, not tower...", self); pause;
    exec("say What live in tower for me to eat?", self); pause;
    goto init;
}
dilend
end    /* wandering_orc */

                        boggo
names {"boggo", "orc"}
title "Boggo"
descr "Boggo the orc is here, playing with debris from the ground."
extra {}
"&lThis mischievous creature has found its way into the guard room and is
playing with the rubbish that is scattered on the floor.  Obviously it is
trying to impress Baggo."
M_AVG_ORC (8, SEX_MALE)
alignment 0
money 2 COPPER_PIECE

/*  Dil to bring Boggo and Baggo to life.  They will converse back and
    forth.  Dil modified from that in Haon-dor, written by M. Seifert
    (Papi) (?) */

dilbegin boggo1();
code {
  :init:
    heartbeat := PULSE_SEC*15;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
    walkto(findroom("floor_1b@tower")); pause; pause;
    exec("emote looks at all of the objects scattered throughout the "+
         "room.", self); pause;
    send("boggo1");
  :start:
    nopriority;
    wait(SFB_MSG, activator.nameidx $= "baggo");
    priority;
    if (argument $= "baggo1") {
      exec("laugh baggo", self); pause;
      exec("say HEHEHE... Baggo look like fighter man!", self); pause;
      send("boggo2");
    }
    if (argument $= "baggo2") {
      exec("emote begins running from Baggo.", self); pause;
      exec("say HEY!  What for you chase Boggo for?", self); pause;
      send("boggo3");
    }
    if (argument $= "baggo3") {
      exec("emote picks up a large piece of wood that is lying in a "+
           "corner and looks at Baggo mischievously.", self); pause;
      send("boggo4");
    }
    if (argument $= "baggo4") {
      exec("emote snarls and runs after Baggo, waving his wooden club "+
           "wildly.", self); pause;
      send("boggo5");
    }
    if (argument $= "baggo5") {
      exec("emote trips over his own feet, and lands HARD on his face.",
           self); pause;
      exec("say Ow!  How come Boggo fall down so hard?", self);
           pause;
      send("boggo6"); pause;
      exec("emote sits up and rubs his bruised head.", self); pause;
      goto init;
    }
    goto start;
}
dilend
special SFUN_TEAMWORK "baggo"
end    /* boggo */

                        baggo
names {"baggo", "orc"}
title "Baggo"
descr "Baggo the orc is here, playing with debris from the ground."
extra {}
"&lThis mischievous creature has found its way into the guard room and is
playing with the rubbish that is scattered on the floor.  Obviously it is
trying to impress Boggo."
M_AVG_ORC (8, SEX_MALE)
alignment 0
money 2 COPPER_PIECE

/*  Dil to bring Boggo and Baggo to life.  They will converse back and
    forth.  Dil modified from that in Haon-dor, written by M. Seifert
    (Papi) (?) */

dilbegin baggo1();
code {
  :init:
    heartbeat := PULSE_SEC*15;
    walkto(findroom("floor_1b@tower"));
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    nopriority;
    wait(SFB_MSG, activator.nameidx $= "boggo");
    priority;
    if (argument $= "boggo1") {
      exec("emote picks up some old metal and wields it like a sword.",
           self); pause;
      send("baggo1");
    }
    if (argument $= "boggo2") {
      exec("emote begins chasing Boggo with his new weapon.",
           self); pause;
      send("baggo2");
    }
    if (argument $= "boggo3") {
      exec("say Hahaha... Boggo runs like monkey from mighty Baggo!  "+
           "Hehehe...", self); pause;
      send("baggo3");
    }
    if (argument $= "boggo4") {
      exec("say Hey, what Boggo do now?", self); pause;
      send("baggo4");
    }
    if (argument $= "boggo5") {
      exec("emote howls, drops his metal, and runs screaming from Boggo.",
           self); pause;
      exec("emote yells 'Hey!  Stop chasing poor helpless Baggo!'",
           self); pause;
      send("baggo5");
    }
    if (argument $= "boggo6") {
      exec("laugh boggo", self); pause;
      goto init;
    }
    goto start;
}
dilend
special SFUN_TEAMWORK "boggo"
end    /* boggo */

                        tower_goblin
names {"goblin"}
title "a goblin"
descr "A goblin is here, searching for something to eat."
extra {}
"&lThis goblin must have happened upon the tower while travelling in the land.
It wears only a few tattered rags, and carries only a small sack.  It is
truly a pitiful creature."
M_AVG_GOBLIN (10, SEX_MALE)
alignment -300
money 1 COPPER_PIECE
special SFUN_RANDOM_ZONE_MOVE time 350 bits SFB_RANTIME

/*  Dil to bring tower goblin to life */

dilbegin goblin1();
code {
  :init:
    heartbeat := PULSE_SEC*20;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("say Tasty morsels!  Yes, tasty morsels will be in tall "+
         "tower!", self); pause;
    exec("emote begins rummaging through some debris in a corner.",
         self); pause;
    exec("say Maybe a nice mousey!  Oh yes, a nice mousey for yummy "+
         "dinner!", self); pause;
    exec("emote grins evilly.", self); pause;
    exec("say Elfsies in tower... maybe find elfsies in tower!",
         self); pause;
    exec("emote mumbles something about yummy elfsies.", self); pause;
    exec("say Where could nice, scrumptous elfsies be hiding?",
         self); pause;
    exec("emote scratches his head.", self); pause;
    exec("say Can't find elfsies, can't find mouseys, but tummy "+
         "grumbles!", self); pause;
    exec("emote mutters something about the mean, hiding elfsies.",
         self); pause;
    exec("emote takes something foul from his sack and begins eating.",
         self); pause;
    exec("emote finishes his meal and rubs his stomach.", self); pause;
    exec("say Tummy still grumbling!  Must look elsewhere to find "+
         "yummies...", self); pause;
    exec("say But where can yummies be hiding?", self); pause;
    exec("emote looks puzzled.", self); pause; pause;
    goto init;
}
dilend
end    /* tower_goblin */

                        kvork
names {"kvork", "goblin"}
title "Kvork"
descr "Kvork the goblin is here."
extra {}
"&lThis goblin must have happened upon the tower while travelling in the
land.  He stands about seven feet tall and does not look at all happy to
see you.  Several scars cover his green body, indicating that he has
survived more than a few confrontations during his lifetime."
M_AVG_GOBLIN (10, SEX_MALE)
alignment -200
money 12 IRON_PIECE

/*  Dil to bring Kvork and Tgark to life.  They will exchange conversation,
    and walk around the second floor.  Dil modified from that in Haon-dor,
    written, by M. Seifert (Papi) (?) */

dilbegin kvork1();
var
  num : integer;
code {
  num := 0;
  :init:
    heartbeat := PULSE_SEC*15;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
    walkto(findsymbolic("tgark@tower"));
    exec("emote asks 'Tgark, you have morsels to be eating?  I all out.'",
         self); pause;
    send("kvork1");
  :start:
    nopriority;
    wait(SFB_MSG, activator.nameidx $= "tgark");
    priority;
    if (argument $= "tgark1") {
      exec("say No morsels!  What we do now?", self); pause;
      send("kvork2");
    }
    if (argument $= "tgark2") {
      exec("say Me no steal morsels!  What for you call me thief?",
           self); pause;
      send("kvork3");
    }
    if (argument $= "tgark3") {
      exec("emote looks confused.", self); pause;
      exec("say But me no take morsels... maybe we go look and find more?",
           self); pause;
      send("kvork4");
    }
    if (argument $= "tgark4") {
      exec("emote beams proudly.", self); pause;
      send("kvork5");
    }
    if (argument $= "tgark5") {
      exec("say Ummm... don't know where to look...", self); pause;
      exec("emote looks confused.", self); pause;
      exec("say Maybe find morsels in my bag?", self); pause;
      exec("emote looks in his bag.", self); pause;
      exec("say No morsels... c'mon, we go look around!", self); pause;
      if (num == 0) {
        walkto(findroom("floor_2k@tower"));
        exec("emote points at the tapestry.", self); pause;
        exec("say Mean elf man live over there!  We no stay here!",
             self); pause;
        walkto(findroom("floor_2g@tower"));
        send("kvork6");
        pause;
        exec("drink from fountain", self); pause;
        exec("say Yummy water...", self); pause;
        walkto(findroom("floor_2c@tower")); pause;
        num := 1;
      }
      else {
        walkto(findroom("floor_2k@tower"));
        exec("emote points at the tapestry.", self); pause;
        exec("say Mean elf man live over there!  We no stay here!",
             self); pause;
        walkto(findroom("floor_2j@tower"));
        num := 0;
      }
      goto init;
    }
    goto start;
  :waitawhile:
    heartbeat := PULSE_SEC*60;
    pause;
    goto init;
}
dilend
special SFUN_TEAMWORK "tgark"
end    /* kvork */

                        tgark
names {"tgark", "goblin"}
title "Tgark"
descr "Tgark the goblin is here."
extra {}
"&lThis goblin must have happened upon the tower during his travels with
Kvork.  He stands about seven feet tall and does not look at all happy
to see you.  Several scars cover his green body, indicating that he has
survived more than a few confrontations during his lifetime."
M_AVG_GOBLIN (10, SEX_MALE)
alignment -200
money 12 IRON_PIECE

/*  Dil to bring Kvork and Tgark to life.  They will exchange conversation,
    and walk around the second floor.  Dil modified from that in Haon-dor,
    written, by M. Seifert (Papi) (?) */

dilbegin tgark1();
code {
  :init:
    heartbeat := PULSE_SEC*15;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    nopriority;
    wait(SFB_MSG, activator.nameidx $= "kvork");
    priority;
    if (argument $= "kvork1") {
      exec("emote looks into his bag.", self); pause;
      exec("say No more morsels in bag...", self); pause;
      send("tgark1");
    }
    if (argument $= "kvork2") {
      exec("say Where did morsels go?  Me had full bag before...",
           self); pause;
      exec("emote sinks not-so-deeply into his own thoughts.", self);
           pause;
      exec("say Hey -- maybe you steal morsels from me!", self); pause;
      exec("growl", self); pause;
      send("tgark2");
    }
    if (argument $= "kvork3") {
      exec("say Give back stolen yummies!  Me want morsels back now!",
           self); pause;
      exec("emote growls again.", self); pause;
      send("tgark3");
    }
    if (argument $= "kvork4") {
      exec("emote scratches his head.", self); pause;
      exec("say Look for morsels?  That good idea -- you getting smart!",
           self); pause;
      send("tgark4");
    }
    if (argument $= "kvork5") {
      exec("say But where we look?", self); pause;
      exec("emote looks confused.", self);
      send("tgark5");
    }
    if (argument $= "kvork6") {
      exec("drink from fountain", self); pause;
      exec("emote smiles happily.", self);
    }
    goto start;
}
dilend
special SFUN_TEAMWORK "kvork"
end    /* tgark */

                        inexp_thief
names {"inexperienced thief", "thief"}
title "the thief"
descr "A dirty and sickly looking young thief is here."
extra {}
"&lThis man looks truly miserable.  It is obvious from his disheveled
appearance and lost look that he is not used to the line of work which
he has entered upon.  You begin to feel sorry for him until you notice
him staring at your wallet..."
M_HUMAN_THIEF_SWORD(9, SEX_MALE)
money 2 IRON_PIECE
alignment -300
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil to bring thief to life */

dilbegin thief1();
code {
  :init:
    heartbeat := PULSE_SEC*20;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("emote groans.", self); pause;
    exec("say Ohhh... why did I eat those berries...", self); pause;
    exec("say You!  Leave me alone!  I feel horrible...", self); pause;
    exec("emote grabs his stomach.", self);
    exec("emote turns away from you and begins wretching.", self); pause;
    exec("say Get away from me!  I want to be left alone!", self); pause;
    exec("emote mumbles 'Someone should have told me that those berries "+
         "would make me sick...'", self); pause;
    exec("emote looks like he may throw up again.", self); pause;
    exec("say I thought I told you to leave me!  Get out of here now!",
         self); pause;
    exec("say Will you leave me alone, or am I going to have to make you "+
         "leave?", self); pause;
    exec("emote groans.", self); pause;
    exec("say You are lucky I am so ill, or you would not still be "+
         "standing there staring!", self); pause;
    goto init;
}
dilend
end    /* inexp_thief */

                        lassiter
names {"lassiter", "mercenary"}
title "Lassiter"
descr "Lassiter the mercenary is resting here."
extra {}
"&lLassiter is a battle-scarred mercenary who has apparently come to the
tower to rest for the evening.  He scowls at you as you approach --
obviously he is not seeking company.  This man is not one to be trifled
with, so perhaps you should move on..."
M_HUMAN_THIEF_SWORD (11, SEX_MALE)
money 11 IRON_PIECE, 2 COPPER_PIECE
alignment -50
MSET_WEAPON(15,15,15,15,10,15)
romflags {CHAR_DETECT_INVISIBLE}

/*  Dil to bring Lassiter to life -- he will say different things,
    depending on the value of num, a random integer.  He may become
    aggressive. */

dilbegin lassiter1();
var
  pcname : string;
  item   : unitptr;
  pc     : unitptr;
  num    : integer;
  expd   : extraptr;
code {
  :init:
    heartbeat := PULSE_SEC*10;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    wait(SFB_CMD,(activator.type == UNIT_ST_PC));
    pc := activator;
    secure(pc,lostpc);
    num := rnd(1,40);
    exec("emote growls at you.", self); pause;
    exec("say Begone!  I wish to be alone!", self); pause;
    exec("emote glances at you, sizing you up.", self); pause;
    exec("say Do you wish to die today?", self); pause;
    exec("say I have killed men of greater stature than you...", self);
         pause;
    exec("emote removes a long dagger from a pouch at his side.", self);
         pause;
    exec("say This is my final warning to you!  Begone!", self); pause;
    if ((num >= 1) and (num < 20)) {
      exec("sigh", self); pause;
      exec("emote puts his dagger back into its pouch.", self); pause;
      exec("say I have killed many in my time... the work has wearied me.",
           self); pause; pause;
      exec("sigh", self); pause;
      exec("say Go now, and I shall let you live.", self); pause; pause;
    }
    else if ((num >= 20) and (num < 32)) {
      exec("emote looks at you in a funny way.", self); pause;
      exec("say I see that you have no plans of leaving me, "+pc.name +
           ".", self); pause;
      exec("say You show true bravery.  I admire your courage.", self);
           pause;
      exec("say Stay if you so choose.  Just be sure you do not "+
           "disturb me.", self); pause; pause;
    }
    else if ((num >= 32) and (num < 40)) {
      exec("say I have been more than patient with you!  Prepare for "+
           "your death, "+pc.name +"!", self);
      exec("kill "+pc.name, self);
    }
    unsecure(pc);
    goto waitawhile;
  :waitawhile:
    heartbeat := PULSE_SEC*30;
    pause;
    goto init;
  :lostpc:
    pause;
    goto start;
}
dilend
end    /* lassiter */

                        orc_soldier
names {"orc soldier", "orc", "soldier"}
title "an orc soldier"
descr "An orc soldier is here."
extra {}
"&lThe orc wears a tattered uniform from some orc army.  He is apparently a
deserter, since there are no orc military units that you know of anywhere
in this section of the land.  He looks weary, but you are certain that he is
not too tired to be able to quickly wield the rusty dagger that hangs at
his side."
M_AVG_ORC (11, SEX_MALE)
alignment -150
money 1 COPPER_PIECE

/*  Dil to bring orc soldier to life */

dilbegin orc_soldier1();
code {
  :init:
    heartbeat := PULSE_SEC*20;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("emote grunts.", self); pause;
    exec("say Hmmph.  Me good soldier.  No care what captain say.",
         self); pause;
    exec("emote grunts.", self); pause;
    exec("emote breaks wind.", self); pause;
    exec("say Me prove to captain that me good fighter!", self); pause;
    exec("say But first me need to find someone to fight...",
         self); pause;
    exec("emote looks puzzled.", self); pause;
    exec("say How to fight if no one to fight with???", self); pause;
    exec("emote begins sobbing like a child.", self); pause;
    exec("emote stops crying and scratches his head.", self); pause;
    exec("say What for was I crying?", self); pause;
    exec("emote looks puzzled.", self); pause;
    goto init;
}
dilend
end    /* orc_soldier */

                        orc_renegade
names {"renegade orc", "orc", "renegade"}
title "a renegade orc"
descr "An orc is here, plotting mischief."
extra {}
"&lThis orc stands here wearing a defiant scowl.  Although orcs are generally
never up to anything good, you sense that this creature is plotting some
particularly nasty evil.  His body is scarred and his appearance ragged,
making you wonder if you should attempt any action against him."
M_AVG_ORC (13, SEX_MALE)
alignment -150
money 1 COPPER_PIECE, 15 IRON_PIECE

/*  Dil to bring orc renegade to life */

dilbegin orc_renegade1();
code {
  :init:
    heartbeat := PULSE_SEC*40;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("emote gazes at you coldly.", self); pause;
    exec("say Have not killed anyone yet today...", self); pause;
    exec("emote looks around wildly.", self); pause;
    exec("say World is evil place... ", self); pause;
    exec("say Will find someone to kill before day over...", self); pause;
    exec("emote snarls viciously.", self); pause;
    exec("emote growls.", self); pause;
    goto init;
}
dilend
end    /* orc_renegade */

                        str_guardian
names {"strange guardian", "guardian"}
title "a strange guardian"
descr "A strange guardian is watching the area."
extra {}
"&lIt is difficult to describe what you see before you.  This creature is
neither here, nor is it not here.  While it appears to be somewhat solid,
it does not seem to exist completely within your physical plane.  Its
shape is constantly changing, and its color varies from a bright white
to a light blue.  The creature does seem to be aware of your presence,
and you wonder if it might perhaps be hostile."
level 12
alignment 150
race RACE_SPIRIT
sex SEX_NEUTRAL
weight 100
height 150
NATURAL_DEF(WPN_FIST, ARM_PLATE)
MSET_ABILITY(20,20,10,10,10,10,20,0)
MSET_WEAPON(2,2,2,2,29,2)
MSET_SPELL(2,2,2,28,2,2,2,2,2,15,2)
special SFUN_TEAMWORK "strange guardian"
special SFUN_RANDOM_ZONE_MOVE time 150 bits SFB_RANTIME

/*  Dil to bring strange guardian to life */

dilbegin str_guardian1();
code {
  :init:
    heartbeat := PULSE_SEC*40;
    on_activation((self.position <= POSITION_SLEEPING) or
         (self.position == POSITION_FIGHTING), skip);
  :start:
    exec("emote begins emanating a rather subtle humming noise.", self);
         pause;
    exec("emote suddenly turns a brilliant shade of blue.", self); pause;
    exec("emote turns completely silent.", self); pause;
    exec("emote fades from view, but then slowly reappears.", self); pause;
    goto init;
}
dilend
end    /* mys_guardian */


%objects

/*    ******    Inventory for objects    ******    */
/*
     entrance sign     floor_1m       (1 max)
     gnarled sign      tower_north    (1 max)
       ***********  LOAD 4G ITEM  ************
       ***********  LOAD 2J ITEM  ************
     tower fountain    floor_2g       (1 max)
     leather bag       misc. mobs     (1 per mob)
     lassiter dagger   lassiter       (1 for lassiter)
     wooden coffer     floor_3m       (1 max)
     coffer key        floor_3l       (dil loaded...related to quest)
     wine barrel       floor_4h       (1 max)
     bronze_medallion  floor_4g       (loaded after searching)
     juniper berries   by_stream      (2 per reset...related to quest)
     aristol's book    floor_3m       (1 per reset...related to quest)
     eiyonel's note    eiyonel        (quest loaded)
     aristol dagger    aristol        (quest loaded)
     basement key      drynmyr        (quest loaded)
     obsidian shard    under_chamber1 (dil loaded...related to quest)
     elven star shard  under_chamber3 (dil loaded...related to quest)
     drynmyr note      drynmyr        (quest loaded)
     kithyrn sleeves   sarinyil       (quest loaded)
     kithyrn pendant   sarinyil       (quest loaded)
     kithyrn leggings  sarinyil       (quest loaded)
     kithryn hammer    five elves     (1 per tower elf)
*/

                        entrance_sign
names {"entrance sign", "sign"}
title "the entrance sign"
descr "A rather important looking sign is here."
extra {}
"&lThe sign reads:

        'Welcome all travellers to the tower Kithyrn, especially
        those who are of the levels 5 to 14.  Seek out the four
        tower elves who have remained to guard the tower treasures,
        one on each floor, and search everywhere as you explore the
        tower since there is much to be found here.  Report all
        bugs to Kira.' "
weight 20
type ITEM_NOTE
end    /* entrance_sign */

                        gnarled_sign
names {"gnarled sign", "weather-worn sign", "sign"}
title "the gnarled sign"
descr "A weather-worn sign is barely visible from behind a boulder here."
extra {}
"&lThe sign reads:

        'Respect the sacred places of the tower Kithyrn.
        Venture to the tower's lower levels only those who
        have first obtained the blessing of Drynmyr.'"
weight 20
type ITEM_NOTE
end    /* gnarled_sign */

                        leather_bag
names {"leather bag", "bag"}
title "a leather bag"
descr "A leather bag is lying here."
extra {}
"&lThis bag is made of strong leather and looks like it would hold a
number of items safely."
weight 1
CONTAINER_DEF(75)
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD, MANIPULATE_ENTER}
end    /* leather_bag */

                        lassiter_dagger
names {"lassiter's dagger", "dagger"}
title "a dagger"
descr "A long dagger lies here."
extra {}
"&lThis dagger is sharp, about a foot long, and obviously made for only one
purpose.  How many throats might this cruel blade have slit during its
time?  Only a twisted and evil individual would want to use a weapon such
as this one."
manipulate {MANIPULATE_TAKE, MANIPULATE_WIELD}
WEAPON_DEF(WPN_DAGGER, 0, 0)
weight 1
end   /* lassiter_dagger */

                        tower_fountain
names {"elven fountain", "fountain", "statue", "water"}
title "a small elven fountain"
descr "Water bubbles up from a small fountain that is here."
extra {}
"&lThis fountain is an amazing piece of work that must have taken a great
deal of time to complete.  The balance and simplicity of this artwork
make it truly incredible."
LIQ_DEF(LIQ_WATER, 500, 500, 500, 0)
end    /* tower_fountain */

                        wooden_coffer
names {"wooden coffer", "coffer"}
title "a wooden coffer"
descr "A rather ordinary looking wooden coffer is here."
extra {}
"&lThis coffer is quite plain in all respects.  The wood of which it is made
bears no ornamentation, although it does look quite sturdy.  Each of the
four legs of this strongbox have been securely fastened to the floor,
eliminating any ideas you might have had of carrying off the entire box.
There is a keyhole on the front of the box, but without the proper key it
is doubtful that you will ever be able to find out what might be inside..."
weight 50
CONTAINER_DEF(300)
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_PICKPROOF}
key coffer_key
manipulate {MANIPULATE_ENTER}
end    /* wooden_coffer */

                        coffer_key
names {"coffer key", "key"}
title "the key to the coffer"
descr "The key to the coffer is here."
extra {}
"This key looks like any other and bears the inscription 'coffer key'."
type ITEM_KEY
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
weight 1
special SFUN_BLOW_AWAY "The coffer key disappears in a strange blue flash."
        time WAIT_SEC*60 bits SFB_RANTIME
end    /* coffer_key */

                        barrel_o_wine
names {"wine barrel", "barrel", "wine"}
title "a barrel"
descr "An open barrel is here."
extra {}
"The barrel is not unlike the others in this room, and is labeled 'wine.'"
LIQ_DEF(LIQ_WINE, 15, 50, 50, 0)
end    /* barrel_o_wine */

                        bronze_medallion
names {"bronze medallion", "medallion"}
title "a bronze medallion"
descr "A bronze medallion has been left here."
extra {}
"The medallion is merely a simple bronze disk suspended on a leather cord.
It is tarnished and dirty, although the mark of the tower elves has been
stamped onto the back of it, leading you to believe that it may in some
way be valuable."
extra {"$identify"}
"The medallion does not seem to possess any magical bonuses."
extra {"$improved identify"}
"The medallion does not seem to possess any magical bonuses."
manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_NECK}
weight 1
special SFUN_BLOW_AWAY "The medallion disappears in a strange blue flash."
        time WAIT_SEC*60 bits SFB_RANTIME
end   /* bronze_medallion */

                        juniper_berries
names {"juniper berries", "berries"}
title "juniper berries"
descr "A small bunch of juniper berries is here."
extra {}
"Although these berries look lovely, it would be unwise to eat them."
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
FOOD_DEF(3, 4)
weight 1
end   /* juniper_berries */

                        aristol_book
names {"aristol's book", "book"}
title "Aristol's book"
descr "A book of elven history lies here."
extra {}
"&lThe book is a record of the battles of the elves of the tower Kithyrn.
Its pages are worn and aged, indicating that it is a rather ancient volume."
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
type ITEM_BOOK
weight 1
end   /* aristol_book */

                        eiyonel_note
names {"eiyonel's note", "note"}
title "Eiyonel's note"
descr "A bit of paper is lying here."
extra {}
"&lEiyonel has scribbled just a few words on this paper.  Apparently it is
a brief message to Lorimar."
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
type ITEM_NOTE
weight 1
end   /* eiyonel_note */

                        aristol_dagger
names {"aristol's dagger", "dagger"}
title "Aristol's dagger"
descr "A fine elven dagger is here."
extra {}
/*"&lWhile it is beautifully made, this dagger does not look like something
that you would want to be killing dragons with.  Still, it is a fine
looking weapon, and you feel that it may serve some great purpose. */
"&lAn inscription written upon its hilt reads 'For the soul of the ethereal
warrior alone do I lust.'
     (NOTE:  In order for this dagger to work, you must use the 'kill'
     command.  If you use the 'hit' or 'backstab' commands the warrior
     will kill you.  Quickly.  Very quickly, actually.)"
flags {UNIT_FL_MAGIC}
manipulate {MANIPULATE_TAKE, MANIPULATE_WIELD}
WEAPON_DEF(WPN_DAGGER, 0, 0)
weight 1
cost 3 IRON_PIECE
rent 1 COPPER_PIECE

/*  Dil to allow players to use dagger and advance past ethereal warrior.
    Dil modified from bridge stick, written by Andrew Cowan (Icculus) */

dilbegin aristol_dagger1();
var
  pc : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*2;
  :start:
    wait(SFB_CMD, (activator.type == UNIT_ST_PC) and (command(CMD_KILL)));
    if ((activator.name $= self.outside.name) and
         (self.equip == WEAR_WIELD)) {
      pc := activator;
      secure(pc, lostpc);
    }
    else
      goto start;
    if (("ethereal warrior" in argument) or ("warrior" in argument)) {
      block;
      if (not(ARISTOL_COMPLETE in pc.quests) and not(KITHYRN_COMPLETE in
           pc.quests)) {
        act("Perhaps you should seek counsel with Aristol before "+
             "attacking this creature.", A_ALWAYS, self.outside, null,
             null, TO_CHAR);
        goto start;
      }
      act("Your dagger glows as you plunge it into the heart of the "+
           "ethereal warrior. As it sinks in up to its hilt there is a "+
           "bright light, and suddenly you are no longer in the same "+
           "room.", A_ALWAYS, self.outside, null, null, TO_CHAR);
      act("As "+pc.name+ "'s dagger sinks into the ethereal warrior a "+
           "sudden brightness fills the room, and as it subsides you "+
           "notice that your companion has disappeared.", A_SOMEONE,
           self.outside, null, null, TO_REST);
      pause;
      link(pc, findroom("tower/floor_4j"));
      exec("look", pc);
      act(pc.name+" has arrived.", A_HIDEINV, self.inside,
           null, null, TO_REST);
      unsecure(pc);
      goto start;
    }
  :lostpc:
    pause;
    goto start;
}
dilend
end   /* aristol_dagger */

                        basement_key
names {"basement key", "key"}
title "the key to the basement"
descr "A small silver key is here."
extra {}
"&lThis key is small and made of silver.  It bears the mark of the tower
elves, and is inscribed with the words 'Under Kithyrn'."
type ITEM_KEY
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
weight 1
end    /* basement_key */

                        obsidian_piece
names {"obsidian piece", "obsidian", "piece"}
title "a piece of obsidian"
descr "A piece of obsidian is here."
extra {}
"&lThis stone is jet black and oval-shaped.  It bears no markings at all, yet
still looks like it might be important."
type ITEM_KEY
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
weight 1
special SFUN_BLOW_AWAY "The obsidian disappears in a strange blue flash."
        time WAIT_SEC*60 bits SFB_RANTIME
end    /* obsidian_piece */

                        star_shard
names {"elven star shard", "shard", "artifact"}
title "a shard of the elven star"
descr "A beautiful elven artifact has been left here."
extra {}
"&lThe beauty of this elven jewel is beyond words-- it is truly exquisite.
It is about the same size as your fist, and its shape is for the most
part round.  You guess that its name comes from the manner in which it
scatters light, making it look very much like one of the stars in the
heavens.  The color of the gem is at first glance blue, although upon
closer inspection you discover a rainbow of colors contained within the
heart of this ancient elven artifact."
flags {UNIT_FL_MAGIC}
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
weight 1
cost 1 IRON_PIECE
rent 5 SILVER_PIECE
end   /* star_shard */

                        drynmyr_note
names {"drynmyr's note", "note"}
title "Drynmyr's note"
descr "A bit of old paper is lying here."
extra {}
"&lThe note reads:
       'To gain admittance to the rooms which hold the tower
       treasures, three guardians must be passed.  The third of
       these three is a knight not of this world, who will allow
       passage only when the words 'allinom baril' are uttered.
       Do not forget, for only these words of power will allow
       you to pass.'"
manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
type ITEM_NOTE
weight 1
end   /* drynmyr_note */

                        kith_sleeves
names {"kithyrn sleeves", "sleeves"}
title "the Kithyrn sleeves"
descr "Fine elven sleeves are lying here."
extra {}
"&lThese beautiful sleeves are made of lightweight chain mail and are of
immaculate craftsmanship.  They bear markings which indicate that they
are products of the tower elves, and it sends a shudder down your spine
to think that you are looking at an artifact that was perhaps used by
the great elves of the past."
extra {"$identify"}
"The sleeves of the tower elves give the wearer an improved strength and
dexterity."
extra {"$improved identify"}
"These powerful sleeves will add two to your strength and two to your
dexterity."
ARMOUR_HRD_LEATHER(10, 10)
flags {UNIT_FL_MAGIC}
manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ARMS}
STR_TRANSFER(+2)
DEX_TRANSFER(+2)
weight 6
cost 5 GOLD_PIECE
dilcopy quest_restrict@function ("Kithyrn Tower Traversed", 0, 20,"");

/*  Dil to prevent players from wearing two quest items at once.  Dil
    modified from that in Asgaard, written by Andrew Cowan (Icculus) */

dilbegin kith_sleeves1();
var
  pc   : unitptr;
  u1   : unitptr;
  u2   : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_WEAR)));
    u1 := findunit(activator, "kithyrn leggings",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    u2 := findunit(activator, "kithyrn pendant",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    if (not("sleeves" in argument) and not("all" in argument) and
         not("kithyrn sleeves" in argument)) {
      goto start;
    }
    else {
      if (not(u1 #= null) or not(u2 #= null)) {
        block;
        act(activator.name+" is unable to use the Kithyrn sleeves.",
             A_HIDEINV, self.outside, null, null, TO_REST);
        act("You are prevented from using the Kithyrn sleeves -- you may "+
             "not use two treasures of the tower elves simultaneously.",
             A_ALWAYS, self.outside, null, null, TO_CHAR);
        goto start;
      }
    }
}
dilend
end   /* kith_sleeves */

                        kith_pendant
names {"kithyrn pendant", "pendant"}
title "the Kithyrn pendant"
descr "A beautiful elven pendant lies here."
extra {}
"&lThe pendant is a simple jewel which is held on a leather cord by a small
gold claw.  The jewel is green, about two inches long, and rather
unimpressive.  However, it bears the mark of the tower elves, and you wonder
if its simple appearance might only be a camouflage to hide a tremendous
power within."
extra {"$identify"}
"This pendant, created long ago by the tower elves, gives a player improved
intelligence and charisma."
extra {"$improved identify"}
"This ancient pendant will add two to your intelligence and two to your
charisma."
flags {UNIT_FL_MAGIC}
manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_NECK}
BRA_TRANSFER(+2)
CHA_TRANSFER(+2)
weight 2
cost 5 GOLD_PIECE
dilcopy quest_restrict@function ("Kithyrn Tower Traversed", 0, 20,"");

/*  Dil to prevent players from wearing two quest items at once.  Dil
    modified from that in Asgaard, written by Andrew Cowan (Icculus) */

dilbegin kith_pendant1();
var
  pc   : unitptr;
  u1   : unitptr;
  u2   : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_WEAR)));
    u1 := findunit(activator, "kithyrn leggings",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    u2 := findunit(activator, "kithyrn sleeves",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    if (not("pendant" in argument) and not("all" in argument) and
         not("kithyrn pendant" in argument)) {
      goto start;
    }
    else {
      if (not(u1 #= null) or not(u2 #= null)) {
        block;
        act(activator.name+" is unable to use the Kithyrn pendant.",
             A_HIDEINV, self.outside, null, null, TO_REST);
        act("You are prevented from using the Kithyrn pendant -- you may "+
             "not use two treasures of the tower elves simultaneously.",
             A_ALWAYS, self.outside, null, null, TO_CHAR);
        goto start;
      }
    }
}
dilend
end   /* kith_pendant */

                        kith_leggings
names {"kithyrn leggings", "leggings"}
title "the Kithyrn leggings"
descr "A pair of ancient elven leggings lie here."
extra {}
"&lThese leggings are of exquisite quality and are quite light in weight.
They look very ancient, and the mark of the tower elves has been placed on
them.  You have no doubt that wearing these leggings will benefit any
traveler."
extra {"$identify"}
"The ancient leggings of the tower elves give an individual the ability to
detect invisibility, as well as a bonus in strength and constitution."
extra {"$improved identify"}
"These leggings give a player a bonus of four constitution and one strength,
as well as the ability to detect invisible."
flags {UNIT_FL_MAGIC}
ARMOUR_HRD_LEATHER(10, 10)
manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_LEGS}
CON_TRANSFER(+4)
STR_TRANSFER(+1)
CHAR_FLAG_TRANSFER(CHAR_DETECT_INVISIBLE)
weight 6
cost 5 GOLD_PIECE
dilcopy quest_restrict@function ("Kithyrn Tower Traversed", 0, 20,"");

/*  Dil to prevent players from wearing two quest items at once.  Dil
    modified from that in Asgaard, written by Andrew Cowan (Icculus) */

dilbegin kith_leggings1();
var
  pc   : unitptr;
  u1   : unitptr;
  u2   : unitptr;
code {
  :init:
    heartbeat := PULSE_SEC*3;
  :start:
    wait (SFB_CMD, (activator.type == UNIT_ST_PC) and
         (command(CMD_WEAR)));
    u1 := findunit(activator, "kithyrn sleeves",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    u2 := findunit(activator, "kithyrn pendant",
         FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);
    if (not("leggings" in argument) and not("all" in argument) and
         not("kithyrn leggings" in argument)) {
      goto start;
    }
    else {
      if (not(u1 #= null) or not(u2 #= null)) {
        block;
        act(activator.name+" is unable to use the Kithyrn leggings.",
             A_HIDEINV, self.outside, null, null, TO_REST);
        act("You are prevented from using the Kithyrn leggings -- you may "+
             "not use two treasures of the tower elves simultaneously.",
             A_ALWAYS, self.outside, null, null, TO_CHAR);
        goto start;
      }
    }
}
dilend
end   /* kith_leggings */

                        kith_hammer
names {"kithyrn hammer"}
title "the Kithyrn hammer"
descr "A hammer of the tower elves lies here."
extra {}
"&lThis hammer was made specifically for the elves of the tower Kithyrn.  It
is of fine craftsmanship, but bears the inscription 'Only by the tower
elves may I be wielded.'"
flags {UNIT_FL_MAGIC}
manipulate {MANIPULATE_TAKE, MANIPULATE_WIELD}
WEAPON_DEF(WPN_WAR_HAMMER, 25, 25)
weight 4
cost 1  IRON_PIECE
rent 10 GOLD_PIECE

/*  Dil to prevent players from using this hammer -- I don't want to give
    players any reason to kill the mobs who are giving out quests. Dil
    modified from that in Asgaard, written by Andrew Cowan (Icculus) */

dilbegin kithyrn_hammer1();
code {
:start:
wait(SFB_DONE, command(CMD_HOLD) or command(CMD_WIELD) or command(CMD_WEAR));
if ((self.position==WEAR_WIELD) or (self.position==WEAR_HOLD)) {
      act(activator.name+"'s Kithyrn hammer disappears in a blue flash.",
           A_HIDEINV, self.outside, null, null, TO_REST);
      act("The Kithyrn hammer disappears in a blinding flash of blue as "+
           "you attempt to wield it.", A_ALWAYS, self.outside, null,
           null, TO_CHAR);
      if (activator.level < 230) {
        activator.endurance := 0;
        position_update(activator);
      }
      destroy(self);
      goto start;
    }
}
dilend
end    /* kith_hammer */

%reset

/*       *********     Door Settings     *********       */

door floor_1m SOUTH {EX_OPEN_CLOSE}
door before_tower NORTH {EX_OPEN_CLOSE}
door floor_1b EAST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_1c WEST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_1d SOUTH {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door floor_1h NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_1f SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_1j NORTH {EX_OPEN_CLOSE, EX_CLOSED}

door floor_2b EAST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_2c WEST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_2k EAST {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door floor_2l WEST {EX_OPEN_CLOSE, EX_CLOSED}

door floor_3a SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3c NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3d SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3h NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3f EAST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3g WEST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_3k SOUTH {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door floor_3m NORTH {EX_OPEN_CLOSE, EX_CLOSED}

door floor_4c EAST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4d WEST {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4f SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4j NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4h SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4l NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door floor_4m NORTH {EX_OPEN_CLOSE}
door floor_4k SOUTH {EX_OPEN_CLOSE}

door under_entry UP {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}
door tower_north DOWN {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}
door under_passage6 EAST {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_HIDDEN,EX_PICKPROOF}
door under_passage7 WEST {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}
door under_passage5 WEST {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}
door under_passage4 EAST {EX_OPEN_CLOSE, EX_CLOSED, EX_LOCKED, EX_PICKPROOF}

/*       *********     Reset Info for Mobs     *********       */

load inexp_thief into by_stream max 1
  {  load juniper_berries local 1  }

load boggo into floor_1b max 1
  {  equip leather_bag position WEAR_HOLD  }
load baggo into floor_1b max 1
  {  equip leather_bag position WEAR_HOLD  }
load wandering_orc into floor_1g max 3 local 1
  {  equip leather_bag position WEAR_HOLD
     equip orc_scimitar@haon_dor position WEAR_WIELD  }
load tower_goblin into floor_1d max 2 local 1
  {  equip leather_bag position WEAR_HOLD
     equip w_sm_club@halfzon position WEAR_WIELD  }
load eiyonel into floor_1l zonemax 1
  {  equip kith_hammer position WEAR_WIELD max 5  }

load lassiter into floor_2f max 1
  {  equip lassiter_dagger position WEAR_WIELD  }
load kvork into floor_2j max 1
{
  equip leather_bag position WEAR_HOLD
  equip w_sm_club@halfzon position WEAR_WIELD
  follow tgark max 1
    {  equip leather_bag position WEAR_HOLD
       equip w_sm_club@halfzon position WEAR_WIELD  }
}
load orc_soldier into floor_2a max 2 local 1
  {  equip leather_bag position WEAR_HOLD
     equip orc_scimitar@haon_dor position WEAR_WIELD  }
load aristol into floor_2d zonemax 1
  {  equip kith_hammer position WEAR_WIELD max 5  }

load str_guardian into floor_3g max 5 local 2
load drynmyr into floor_3e zonemax 1
  {  equip kith_hammer position WEAR_WIELD max 5  }

load orc_renegade into floor_4c zonemax 1
  {  equip orc_scimitar@haon_dor position WEAR_WIELD  }
load kerril into floor_4h max 1
load lorimar into floor_4l zonemax 1
  {  equip kith_hammer position WEAR_WIELD max 5  }
load eth_warrior into floor_4k zonemax 1
load mys_knight into floor_4j zonemax 1
load sarinyil into floor_4b zonemax 1
  {  equip kith_hammer position WEAR_WIELD max 5  }

/*       *********     Reset Info for Objects     *********       */

load gnarled_sign into tower_north max 1
load entrance_sign into floor_1m max 1
remove tower_fountain@tower in floor_2g
load tower_fountain into floor_2g local 1
remove wooden_coffer@tower in floor_3m@tower
load wooden_coffer into floor_3m
  {  load aristol_book  }
load barrel_o_wine into floor_4h max 1

%end



